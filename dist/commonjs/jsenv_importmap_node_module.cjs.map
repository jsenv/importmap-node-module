{
  "version": 3,
  "file": "jsenv_importmap_node_module.cjs",
  "sources": [
    "../../src/internal/assertInitialImportMap.js",
    "../../src/internal/package_conditions.js",
    "../../src/internal/logs.js",
    "../../src/internal/resolveFile.js",
    "../../src/internal/from-package/resolvePackageMain.js",
    "../../src/internal/from-package/visitPackageImportMap.js",
    "../../src/internal/from-package/specifierIsRelative.js",
    "../../src/internal/from-package/visitPackageImports.js",
    "../../src/internal/from-package/visitPackageExports.js",
    "../../src/internal/memoizeAsyncFunction.js",
    "../../src/internal/from-package/readPackageFile.js",
    "../../src/internal/from-package/applyPackageManualOverride.js",
    "../../src/internal/from-package/node-module-resolution.js",
    "../../src/internal/from-package/visitNodeModuleResolution.js",
    "../../src/internal/optimizeImportMap.js",
    "../../src/internal/from-js/resolveProjectEntryPoint.js",
    "../../node_modules/@jsenv/core/helpers/import-meta/import-meta-url-commonjs.js",
    "../../src/internal/from-js/parseImportSpecifiers.js",
    "../../src/internal/from-js/showSource.js",
    "../../src/internal/from-js/visitSourceFiles.js",
    "../../src/internal/importMapToVsCodeConfigPaths.js",
    "../../src/writeImportMapFiles.js"
  ],
  "sourcesContent": [
    "export const assertInitialImportMap = (value) => {\n  if (value === null) {\n    throw new TypeError(`initialImportMap must be an object, got null`)\n  }\n\n  const type = typeof value\n  if (type !== \"object\") {\n    throw new TypeError(`initialImportMap must be an object, received ${value}`)\n  }\n\n  const { imports = {}, scopes = {}, ...rest } = value\n  const extraKeys = Object.keys(rest)\n  if (extraKeys.length > 0) {\n    throw new TypeError(\n      `initialImportMap can have \"imports\" and \"scopes\", found unexpected keys ${extraKeys}`,\n    )\n  }\n\n  if (typeof imports !== \"object\") {\n    throw new TypeError(\n      `initialImportMap.imports must be an object, found ${imports}`,\n    )\n  }\n\n  if (typeof scopes !== \"object\") {\n    throw new TypeError(\n      `initialImportMap.scopes must be an object, found ${imports}`,\n    )\n  }\n}\n",
    "export const packageConditionsFromPackageUserConditions = ({\n  runtime,\n  packageUserConditions,\n}) => {\n  if (typeof packageUserConditions === \"undefined\") {\n    return [\"import\", runtime, \"default\"]\n  }\n\n  if (!Array.isArray(packageUserConditions)) {\n    throw new TypeError(\n      `packageUserConditions must be an array, got ${packageUserConditions}`,\n    )\n  }\n\n  packageUserConditions.forEach((userCondition) => {\n    if (typeof userCondition !== \"string\") {\n      throw new TypeError(\n        `user condition must be a string, got ${userCondition}`,\n      )\n    }\n  })\n\n  return [...packageUserConditions, \"import\", runtime, \"default\"]\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  resolveUrl,\n} from \"@jsenv/filesystem\"\n\nexport const createPreferExportsFieldWarning = ({\n  packageInfo,\n  packageEntryFieldName,\n}) => {\n  const packageName = packageInfo.object.name\n  const packageEntrySpecifier = packageInfo.object[packageEntryFieldName]\n  const exportsSubpathCondition =\n    packageEntryFieldName === \"browser\" ? \"browser\" : \"import\"\n  const suggestedOverride = {\n    [packageName]: {\n      exports: {\n        [exportsSubpathCondition]: packageEntrySpecifier,\n      },\n    },\n  }\n\n  return {\n    code: \"PREFER_EXPORTS_FIELD\",\n    message: createDetailedMessage(\n      `A package is using a non-standard \"${packageEntryFieldName}\" field. To get rid of this warning check suggestion below`,\n      {\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n        \"suggestion\": `Add the following into \"packageManualOverrides\"\n${JSON.stringify(suggestedOverride, null, \"  \")}\nAs explained in https://github.com/jsenv/importmap-node-module#packagesmanualoverrides`,\n        ...getCreatePullRequestSuggestion({\n          packageInfo,\n          packageEntryFieldName,\n        }),\n      },\n    ),\n  }\n}\n\nexport const createBrowserFieldNotImplementedWarning = ({ packageInfo }) => {\n  const suggestedOverride = {\n    [packageInfo.object.name]: {\n      exports: {\n        browser: packageInfo.object.browser,\n      },\n    },\n  }\n\n  return {\n    code: \"BROWSER_FIELD_NOT_IMPLEMENTED\",\n    message: createDetailedMessage(\n      `Found an object \"browser\" field in a package.json, this is not supported.`,\n      {\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n        \"suggestion\": `Add the following into \"packageManualOverrides\"\n${JSON.stringify(suggestedOverride, null, \"  \")}\nAs explained in https://github.com/jsenv/importmap-node-module#packagesmanualoverrides`,\n      },\n    ),\n  }\n}\n\nconst getCreatePullRequestSuggestion = ({\n  packageInfo,\n  packageEntryFieldName,\n}) => {\n  const repositoryUrl = getRepositoryUrl(packageInfo)\n  if (!repositoryUrl) {\n    return null\n  }\n  return {\n    \"suggestion 2\": `Create a pull request in ${repositoryUrl} to use \"exports\" instead of \"${packageEntryFieldName}\"`,\n  }\n}\n\nconst getRepositoryUrl = (packageInfo) => {\n  const repository = packageInfo.object.repository\n  if (typeof repository === \"string\") {\n    return repository\n  }\n  if (typeof repository === \"object\") {\n    return repository.url\n  }\n  return undefined\n}\n\nexport const createPackageNameMustBeAStringWarning = ({\n  packageName,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_NAME_MUST_BE_A_STRING\",\n    message: createDetailedMessage(`Package name field must be a string`, {\n      \"package name field\": packageName,\n      \"package.json path\": urlToFileSystemPath(packageInfo.url),\n    }),\n  }\n}\n\nexport const createImportResolutionFailedWarning = ({\n  specifier,\n  importedBy,\n  gotBareSpecifierError,\n  magicExtension,\n  suggestsNodeRuntime,\n  automapping,\n}) => {\n  return {\n    code: \"IMPORT_RESOLUTION_FAILED\",\n    message: createDetailedMessage(\n      `Import resolution failed for \"${specifier}\"`,\n      {\n        \"import source\": importedBy,\n        \"reason\": gotBareSpecifierError\n          ? `there is no mapping for this bare specifier`\n          : `file not found on filesystem`,\n        ...getImportResolutionFailedSuggestions({\n          suggestsNodeRuntime,\n          gotBareSpecifierError,\n          magicExtension,\n          automapping,\n        }),\n        // \"extensions tried\": magicExtensions.join(`, `),\n      },\n    ),\n  }\n}\n\nexport const createBareSpecifierAutomappingMessage = ({\n  specifier,\n  importedBy,\n  automapping,\n}) => {\n  return createDetailedMessage(`Auto mapping for \"${specifier}\"`, {\n    \"import source\": importedBy,\n    \"mapping\": mappingToImportmapString(automapping),\n    \"reason\": `bare specifier and \"bareSpecifierAutomapping\" enabled`,\n  })\n}\n\nexport const createExtensionLessAutomappingMessage = ({\n  specifier,\n  importedBy,\n  automapping,\n  mappingFoundInPackageExports,\n}) => {\n  return createDetailedMessage(`Auto mapping for \"${specifier}\"`, {\n    \"import source\": importedBy,\n    \"mapping\": mappingToImportmapString(automapping),\n    \"reason\": mappingFoundInPackageExports\n      ? `no file extension and mapping found in package exports`\n      : `no file extension and \"bareSpecifierAutomapping\" enabled`,\n  })\n}\n\nconst getImportResolutionFailedSuggestions = ({\n  suggestsNodeRuntime,\n  gotBareSpecifierError,\n  magicExtension,\n  automapping,\n}) => {\n  const suggestions = {}\n\n  const addSuggestion = (suggestion) => {\n    const suggestionCount = Object.keys(suggestions).length\n    suggestions[`suggestion ${suggestionCount + 1}`] = suggestion\n  }\n\n  if (suggestsNodeRuntime) {\n    addSuggestion(`use runtime: \"node\"`)\n  }\n  if (automapping) {\n    addSuggestion(\n      `update import specifier to \"${mappingToUrlRelativeToFile(automapping)}\"`,\n    )\n    if (gotBareSpecifierError) {\n      addSuggestion(`use bareSpecifierAutomapping: true`)\n    }\n    if (magicExtension) {\n      addSuggestion(`use extensionlessAutomapping: true`)\n    }\n    addSuggestion(`add mapping to \"initialImportMap\"\n${mappingToImportmapString(automapping)}`)\n  }\n\n  return suggestions\n}\n\nconst mappingToUrlRelativeToFile = (mapping) => {\n  if (!mapping.scope) {\n    return mapping.to\n  }\n  const scopeUrl = resolveUrl(mapping.scope, \"file:///\")\n  const toUrl = resolveUrl(mapping.to, \"file:///\")\n  return `./${urlToRelativeUrl(toUrl, scopeUrl)}`\n}\n\nconst mappingToImportmapString = ({ scope, from, to }) => {\n  if (scope) {\n    return JSON.stringify(\n      {\n        scopes: {\n          [scope]: {\n            [from]: to,\n          },\n        },\n      },\n      null,\n      \"  \",\n    )\n  }\n\n  return JSON.stringify(\n    {\n      imports: {\n        [from]: to,\n      },\n    },\n    null,\n    \"  \",\n  )\n}\n\n// const mappingToExportsFieldString = ({ scope, from, to }) => {\n//   if (scope) {\n//     const scopeUrl = resolveUrl(scope, \"file://\")\n//     const toUrl = resolveUrl(to, \"file://\")\n//     to = `./${urlToRelativeUrl(toUrl, scopeUrl)}`\n//   }\n\n//   return JSON.stringify(\n//     {\n//       exports: {\n//         [from]: to,\n//       },\n//     },\n//     null,\n//     \"  \",\n//   )\n// }\n",
    "import {\n  resolveUrl,\n  readFileSystemNodeStat,\n  urlToFilename,\n  urlToExtension,\n} from \"@jsenv/filesystem\"\nimport { firstOperationMatching } from \"@jsenv/cancellation\"\n\nexport const resolveFile = async (\n  fileUrl,\n  { magicDirectoryIndexEnabled, magicExtensionEnabled, magicExtensions },\n) => {\n  const fileStat = await readFileSystemNodeStat(fileUrl, {\n    nullIfNotFound: true,\n  })\n\n  // file found\n  if (fileStat && fileStat.isFile()) {\n    return {\n      found: true,\n      url: fileUrl,\n    }\n  }\n\n  // directory found\n  if (fileStat && fileStat.isDirectory()) {\n    if (magicDirectoryIndexEnabled) {\n      const indexFileSuffix = fileUrl.endsWith(\"/\") ? \"index\" : \"/index\"\n      const indexFileUrl = `${fileUrl}${indexFileSuffix}`\n      const result = await resolveFile(indexFileUrl, {\n        magicExtensionEnabled,\n        magicDirectoryIndexEnabled: false,\n        magicExtensions,\n      })\n      return {\n        magicDirectoryIndex: true,\n        ...result,\n      }\n    }\n\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  if (!magicExtensionEnabled) {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  // file already has an extension, magic extension cannot be used\n  const extension = urlToExtension(fileUrl)\n  if (extension !== \"\") {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n\n  const extensionLeadingToAFile = await findExtensionLeadingToFile(\n    fileUrl,\n    magicExtensions,\n  )\n  // magic extension not found\n  if (extensionLeadingToAFile === null) {\n    return {\n      found: false,\n      url: fileUrl,\n    }\n  }\n  // magic extension worked\n  return {\n    magicExtension: extensionLeadingToAFile,\n    found: true,\n    url: `${fileUrl}${extensionLeadingToAFile}`,\n  }\n}\n\nconst findExtensionLeadingToFile = async (fileUrl, magicExtensions) => {\n  const urlDirectoryUrl = resolveUrl(\"./\", fileUrl)\n  const urlFilename = urlToFilename(fileUrl)\n  const extensionLeadingToFile = await firstOperationMatching({\n    array: magicExtensions,\n    start: async (extensionCandidate) => {\n      const urlCandidate = `${urlDirectoryUrl}${urlFilename}${extensionCandidate}`\n      const stats = await readFileSystemNodeStat(urlCandidate, {\n        nullIfNotFound: true,\n      })\n      return stats && stats.isFile() ? extensionCandidate : null\n    },\n    predicate: (extension) => Boolean(extension),\n  })\n  return extensionLeadingToFile || null\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  urlToFileSystemPath,\n  urlToExtension,\n  urlToRelativeUrl,\n} from \"@jsenv/filesystem\"\n\nimport {\n  createPreferExportsFieldWarning,\n  createBrowserFieldNotImplementedWarning,\n} from \"../logs.js\"\nimport { resolveFile } from \"../resolveFile.js\"\n\nexport const resolvePackageMain = async ({\n  logger,\n  warn,\n  exportsFieldSeverity = \"warn\",\n  packageInfo,\n  packageConditions,\n}) => {\n  const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n  const packageEntryFieldName = decidePackageEntryFieldName({\n    logger,\n    warn,\n    exportsFieldSeverity,\n    packageConditions,\n    packageInfo,\n  })\n  return tryToResolvePackageEntryFile({\n    packageEntryFieldName,\n    packageDirectoryUrl,\n    packageInfo,\n  })\n}\n\nconst decidePackageEntryFieldName = ({\n  logger,\n  warn,\n  exportsFieldSeverity,\n  packageConditions,\n  packageInfo,\n}) => {\n  let nonStandardFieldFound\n  packageConditions.find((condition) => {\n    if (condition === \"import\") {\n      const moduleFieldValue = packageInfo.object.module\n      if (typeof moduleFieldValue === \"string\") {\n        nonStandardFieldFound = \"module\"\n        return true\n      }\n      const jsNextFieldValue = packageInfo.object[\"jsnext:main\"]\n      if (typeof jsNextFieldValue === \"string\") {\n        nonStandardFieldFound = \"jsnext:main\"\n        return true\n      }\n      return false\n    }\n    if (condition === \"browser\") {\n      const browserFieldValue = packageInfo.object.browser\n      if (typeof browserFieldValue === \"string\") {\n        nonStandardFieldFound = \"browser\"\n        return true\n      }\n      if (typeof browserFieldValue === \"object\") {\n        // the browser field can be an object, for now it's not supported\n        // see https://github.com/defunctzombie/package-browser-field-spec\n        // as a workaround it's possible to use \"packageManualOverrides\"\n        const browserFieldWarning = createBrowserFieldNotImplementedWarning({\n          packageInfo,\n        })\n        if (exportsFieldSeverity === \"warn\") {\n          warn(browserFieldWarning)\n        } else {\n          logger.debug(browserFieldWarning.message)\n        }\n        return false\n      }\n\n      return false\n    }\n    return false\n  })\n  if (nonStandardFieldFound) {\n    const exportsFieldWarning = createPreferExportsFieldWarning({\n      packageInfo,\n      packageEntryFieldName: nonStandardFieldFound,\n    })\n    if (exportsFieldSeverity === \"warn\") {\n      warn(exportsFieldWarning)\n    } else {\n      logger.debug(exportsFieldWarning.message)\n    }\n    return nonStandardFieldFound\n  }\n  return \"main\"\n}\n\nconst tryToResolvePackageEntryFile = async ({\n  packageEntryFieldName,\n  packageDirectoryUrl,\n  packageInfo,\n}) => {\n  const packageEntrySpecifier = packageInfo.object[packageEntryFieldName]\n  // explicitely empty meaning\n  // it is assumed that we should not find a file\n  if (packageEntrySpecifier === \"\") {\n    return { found: false, packageEntryFieldName }\n  }\n\n  const relativeUrlToTry = packageEntrySpecifier\n    ? packageEntrySpecifier.endsWith(\"/\")\n      ? `${packageEntrySpecifier}index`\n      : packageEntrySpecifier\n    : \"./index\"\n\n  const urlFirstCandidate = resolveUrl(relativeUrlToTry, packageDirectoryUrl)\n\n  if (!urlFirstCandidate.startsWith(packageDirectoryUrl)) {\n    return {\n      found: false,\n      packageEntryFieldName,\n      warning: createPackageEntryMustBeRelativeWarning({\n        packageEntryFieldName,\n        packageInfo,\n      }),\n    }\n  }\n\n  const { found, url } = await resolveFile(urlFirstCandidate, {\n    magicDirectoryIndexEnabled: true,\n    magicExtensionEnabled: true,\n    magicExtensions: [\".js\", \".json\", \".node\"],\n  })\n\n  if (!found) {\n    const warning = createPackageEntryNotFoundWarning({\n      packageEntryFieldName,\n      packageInfo,\n      fileUrl: urlFirstCandidate,\n      magicExtensions: [\".js\", \".json\", \".node\"],\n    })\n\n    return {\n      found: false,\n      packageEntryFieldName,\n      relativeUrl: urlToRelativeUrl(urlFirstCandidate, packageInfo.url),\n      warning,\n    }\n  }\n\n  return {\n    found: true,\n    packageEntryFieldName,\n    relativeUrl: urlToRelativeUrl(url, packageInfo.url),\n  }\n}\n\nconst createPackageEntryMustBeRelativeWarning = ({\n  packageEntryFieldName,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_ENTRY_MUST_BE_RELATIVE\",\n    message: createDetailedMessage(\n      `\"${packageEntryFieldName}\" field in package.json must be inside package.json directory`,\n      {\n        [packageEntryFieldName]: packageInfo.object[packageEntryFieldName],\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n\nconst createPackageEntryNotFoundWarning = ({\n  packageEntryFieldName,\n  packageInfo,\n  fileUrl,\n  magicExtensions,\n}) => {\n  return {\n    code: \"PACKAGE_ENTRY_NOT_FOUND\",\n    message: createDetailedMessage(\n      `File not found for package.json \"${packageEntryFieldName}\" field`,\n      {\n        [packageEntryFieldName]: packageInfo.object[packageEntryFieldName],\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n        \"url tried\": urlToFileSystemPath(fileUrl),\n        ...(urlToExtension(fileUrl) === \"\"\n          ? { [\"extensions tried\"]: magicExtensions.join(`, `) }\n          : {}),\n      },\n    ),\n  }\n}\n",
    "import { resolveUrl, moveImportMap } from \"@jsenv/importmap\"\nimport { readFile, urlToFileSystemPath } from \"@jsenv/filesystem\"\n\nexport const visitPackageImportMap = async ({\n  warn,\n  packageInfo,\n  packageImportmap = packageInfo.object.importmap,\n  projectDirectoryUrl,\n}) => {\n  if (typeof packageImportmap === \"undefined\") {\n    return {}\n  }\n\n  if (typeof packageImportmap === \"string\") {\n    const importmapFileUrl = resolveUrl(packageImportmap, packageInfo.url)\n    try {\n      const importmap = await readFile(importmapFileUrl, { as: \"json\" })\n      return moveImportMap(importmap, importmapFileUrl, projectDirectoryUrl)\n    } catch (e) {\n      if (e.code === \"ENOENT\") {\n        warn(\n          createPackageImportMapNotFoundWarning({\n            importmapFileUrl,\n            packageInfo,\n          }),\n        )\n        return {}\n      }\n      throw e\n    }\n  }\n\n  if (typeof packageImportmap === \"object\" && packageImportmap !== null) {\n    return packageImportmap\n  }\n\n  warn(\n    createPackageImportMapUnexpectedWarning({\n      packageImportmap,\n      packageInfo,\n    }),\n  )\n  return {}\n}\n\nconst createPackageImportMapNotFoundWarning = ({\n  importmapFileUrl,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_IMPORTMAP_NOT_FOUND\",\n    message: `importmap file specified in a package.json cannot be found,\n--- importmap file path ---\n${importmapFileUrl}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createPackageImportMapUnexpectedWarning = ({\n  packageImportmap,\n  packageInfo,\n}) => {\n  return {\n    code: \"PACKAGE_IMPORTMAP_UNEXPECTED\",\n    message: `unexpected value in package.json importmap field: value must be a string or an object.\n--- value ---\n${packageImportmap}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n",
    "export const specifierIsRelative = (specifier) => {\n  if (specifier.startsWith(\"//\")) {\n    return false\n  }\n  if (specifier.startsWith(\"../\")) {\n    return false\n  }\n  // starts with http:// or file:// or ftp: for instance\n  if (/^[a-zA-Z]+\\:/.test(specifier)) {\n    return false\n  }\n  return true\n}\n",
    "/*\n\nhttps://nodejs.org/docs/latest-v15.x/api/packages.html#packages_node_js_package_json_field_definitions\n\n*/\n\nimport { urlToFileSystemPath } from \"@jsenv/filesystem\"\nimport { specifierIsRelative } from \"./specifierIsRelative.js\"\n\nexport const visitPackageImports = ({\n  warn,\n  packageInfo,\n  packageImports = packageInfo.object.imports,\n  packageConditions,\n}) => {\n  const importsSubpaths = {}\n  const onImportsSubpath = ({ key, value, trace }) => {\n    if (!specifierIsRelative(value)) {\n      warn(\n        createSubpathValueMustBeRelativeWarning({\n          value,\n          valueTrace: trace,\n          packageInfo,\n        }),\n      )\n      return\n    }\n\n    const keyNormalized = key\n    const valueNormalized = value\n    importsSubpaths[keyNormalized] = valueNormalized\n  }\n\n  const visitSubpathValue = (subpathValue, subpathValueTrace) => {\n    if (typeof subpathValue === \"string\") {\n      return handleString(subpathValue, subpathValueTrace)\n    }\n\n    if (typeof subpathValue === \"object\" && subpathValue !== null) {\n      return handleObject(subpathValue, subpathValueTrace)\n    }\n\n    return handleRemaining(subpathValue, subpathValueTrace)\n  }\n\n  const handleString = (subpathValue, subpathValueTrace) => {\n    const firstBareKey = subpathValueTrace\n      .slice()\n      .reverse()\n      .find((key) => key.startsWith(\"#\"))\n    onImportsSubpath({\n      key: firstBareKey,\n      value: subpathValue,\n      trace: subpathValueTrace,\n    })\n    return true\n  }\n\n  const handleObject = (subpathValue, subpathValueTrace) => {\n    // From Node.js documentation:\n    // \"If a nested conditional does not have any mapping it will continue\n    // checking the remaining conditions of the parent condition\"\n    // https://nodejs.org/docs/latest-v14.x/api/packages.html#packages_nested_conditions\n    //\n    // So it seems what we do here is not sufficient\n    // -> if the condition finally does not lead to something\n    // it should be ignored and an other branch be taken until\n    // something resolves\n    const followConditionBranch = (subpathValue, conditionTrace) => {\n      const bareKeys = []\n      const conditionalKeys = []\n      Object.keys(subpathValue).forEach((availableKey) => {\n        if (availableKey.startsWith(\"#\")) {\n          bareKeys.push(availableKey)\n        } else {\n          conditionalKeys.push(availableKey)\n        }\n      })\n\n      if (bareKeys.length > 0 && conditionalKeys.length > 0) {\n        warn(\n          createSubpathKeysAreMixedWarning({\n            subpathValue,\n            subpathValueTrace: [...subpathValueTrace, ...conditionTrace],\n            packageInfo,\n            bareKeys,\n            conditionalKeys,\n          }),\n        )\n        return false\n      }\n\n      // there is no condition, visit all bare keys (starting with #)\n      if (conditionalKeys.length === 0) {\n        let leadsToSomething = false\n        bareKeys.forEach((key) => {\n          leadsToSomething = visitSubpathValue(subpathValue[key], [\n            ...subpathValueTrace,\n            ...conditionTrace,\n            key,\n          ])\n        })\n        return leadsToSomething\n      }\n\n      // there is a condition, keep the first one leading to something\n      return conditionalKeys.some((keyCandidate) => {\n        if (!packageConditions.includes(keyCandidate)) {\n          return false\n        }\n        const valueCandidate = subpathValue[keyCandidate]\n        return visitSubpathValue(valueCandidate, [\n          ...subpathValueTrace,\n          ...conditionTrace,\n          keyCandidate,\n        ])\n      })\n    }\n\n    return followConditionBranch(subpathValue, [])\n  }\n\n  const handleRemaining = (subpathValue, subpathValueTrace) => {\n    warn(\n      createSubpathIsUnexpectedWarning({\n        subpathValue,\n        subpathValueTrace,\n        packageInfo,\n      }),\n    )\n    return false\n  }\n\n  visitSubpathValue(packageImports, [\"imports\"])\n\n  return importsSubpaths\n}\n\nconst createSubpathIsUnexpectedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_UNEXPECTED\",\n    message: `unexpected subpath in package.json imports: value must be an object or a string.\n--- value ---\n${subpathValue}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createSubpathKeysAreMixedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_MIXED_KEYS\",\n    message: `unexpected subpath keys in package.json imports: cannot mix bare and conditional keys.\n--- value ---\n${JSON.stringify(subpathValue, null, \"  \")}\n--- value at ---\n${subpathValueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n\nconst createSubpathValueMustBeRelativeWarning = ({\n  value,\n  valueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"IMPORTS_SUBPATH_VALUE_UNEXPECTED\",\n    message: `unexpected subpath value in package.json imports: value must be relative to package\n--- value ---\n${value}\n--- value at ---\n${valueTrace.join(\".\")}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}`,\n  }\n}\n",
    "/*\n\nhttps://nodejs.org/docs/latest-v15.x/api/packages.html#packages_node_js_package_json_field_definitions\n\n*/\n\nimport {\n  urlToFileSystemPath,\n  urlToRelativeUrl,\n  resolveUrl,\n} from \"@jsenv/filesystem\"\nimport { createDetailedMessage } from \"@jsenv/logger\"\n\nimport { specifierIsRelative } from \"./specifierIsRelative.js\"\n\nexport const visitPackageExports = ({\n  projectDirectoryUrl,\n  warn,\n  packageInfo,\n  packageExports = packageInfo.object.exports,\n  packageName = packageInfo.name,\n  packageConditions,\n}) => {\n  const exportsSubpaths = {}\n  const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n  const packageDirectoryRelativeUrl = urlToRelativeUrl(\n    packageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n  const onExportsSubpath = ({ key, value, trace }) => {\n    if (!specifierIsRelative(value)) {\n      warn(\n        createSubpathValueMustBeRelativeWarning({\n          value,\n          valueTrace: trace,\n          packageInfo,\n        }),\n      )\n      return\n    }\n\n    const keyNormalized = specifierToSource(key, packageName)\n    const valueNormalized = addressToDestination(\n      value,\n      packageDirectoryRelativeUrl,\n    )\n    exportsSubpaths[keyNormalized] = valueNormalized\n  }\n\n  const visitSubpathValue = (subpathValue, subpathValueTrace) => {\n    // false is allowed as alternative to exports: {}\n    if (subpathValue === false) {\n      return handleFalse()\n    }\n\n    if (typeof subpathValue === \"string\") {\n      return handleString(subpathValue, subpathValueTrace)\n    }\n\n    if (subpathValue === null) {\n      return handleNull(subpathValue, subpathValueTrace)\n    }\n\n    if (typeof subpathValue === \"object\") {\n      return handleObject(subpathValue, subpathValueTrace)\n    }\n\n    return handleRemaining(subpathValue, subpathValueTrace)\n  }\n\n  const handleFalse = () => {\n    // nothing to do\n    return true\n  }\n\n  const handleString = (subpathValue, subpathValueTrace) => {\n    const firstRelativeKey = subpathValueTrace\n      .slice()\n      .reverse()\n      .find((key) => key.startsWith(\".\"))\n    const key = firstRelativeKey || \".\"\n    onExportsSubpath({\n      key,\n      value: subpathValue,\n      trace: subpathValueTrace,\n    })\n    return true\n  }\n\n  const handleNull = () => {\n    // see \"null can be used\" in https://nodejs.org/docs/latest-v16.x/api/packages.html#packages_subpath_patterns\n    return false\n  }\n\n  const handleObject = (subpathValue, subpathValueTrace) => {\n    // From Node.js documentation:\n    // \"If a nested conditional does not have any mapping it will continue\n    // checking the remaining conditions of the parent condition\"\n    // https://nodejs.org/docs/latest-v14.x/api/packages.html#packages_nested_conditions\n    //\n    // So it seems what we do here is not sufficient\n    // -> if the condition finally does not lead to something\n    // it should be ignored and an other branch be taken until\n    // something resolves\n    const followConditionBranch = (subpathValue, conditionTrace) => {\n      const relativeKeys = []\n      const conditionalKeys = []\n      Object.keys(subpathValue).forEach((availableKey) => {\n        if (availableKey.startsWith(\".\")) {\n          relativeKeys.push(availableKey)\n        } else {\n          conditionalKeys.push(availableKey)\n        }\n      })\n\n      if (relativeKeys.length > 0 && conditionalKeys.length > 0) {\n        warn(\n          createSubpathKeysAreMixedWarning({\n            subpathValue,\n            subpathValueTrace: [...subpathValueTrace, ...conditionTrace],\n            packageInfo,\n            relativeKeys,\n            conditionalKeys,\n          }),\n        )\n        return false\n      }\n\n      // there is no condition, visit all relative keys\n      if (conditionalKeys.length === 0) {\n        let leadsToSomething = false\n        relativeKeys.forEach((key) => {\n          leadsToSomething = visitSubpathValue(subpathValue[key], [\n            ...subpathValueTrace,\n            ...conditionTrace,\n            key,\n          ])\n        })\n        return leadsToSomething\n      }\n\n      // there is a condition, keep the first one leading to something\n      return conditionalKeys.some((keyCandidate) => {\n        if (!packageConditions.includes(keyCandidate)) {\n          return false\n        }\n        const valueCandidate = subpathValue[keyCandidate]\n        return visitSubpathValue(valueCandidate, [\n          ...subpathValueTrace,\n          ...conditionTrace,\n          keyCandidate,\n        ])\n      })\n    }\n\n    if (Array.isArray(subpathValue)) {\n      subpathValue = exportsObjectFromExportsArray(subpathValue)\n    }\n    return followConditionBranch(subpathValue, [])\n  }\n\n  const handleRemaining = (subpathValue, subpathValueTrace) => {\n    warn(\n      createSubpathIsUnexpectedWarning({\n        subpathValue,\n        subpathValueTrace,\n        packageInfo,\n      }),\n    )\n    return false\n  }\n\n  visitSubpathValue(packageExports, [\"exports\"])\n\n  return exportsSubpaths\n}\n\nconst exportsObjectFromExportsArray = (exportsArray) => {\n  const exportsObject = {}\n\n  exportsArray.forEach((exportValue) => {\n    if (typeof exportValue === \"object\") {\n      Object.assign(exportsObject, exportValue)\n      return\n    }\n    if (typeof exportValue === \"string\") {\n      exportsObject.default = exportValue\n    }\n  })\n\n  return exportsObject\n}\n\nconst specifierToSource = (specifier, packageName) => {\n  if (specifier === \".\") {\n    return packageName\n  }\n\n  if (specifier[0] === \"/\") {\n    return specifier\n  }\n\n  if (specifier.startsWith(\"./\")) {\n    return `${packageName}${specifier.slice(1)}`\n  }\n\n  return `${packageName}/${specifier}`\n}\n\nconst addressToDestination = (address, packageDirectoryRelativeUrl) => {\n  if (address[0] === \"/\") {\n    return address\n  }\n\n  if (address.startsWith(\"./\")) {\n    return `./${packageDirectoryRelativeUrl}${address.slice(2)}`\n  }\n\n  return `./${packageDirectoryRelativeUrl}${address}`\n}\n\nconst createSubpathIsUnexpectedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_UNEXPECTED\",\n    message: createDetailedMessage(\n      `unexpected value in package.json exports: value must be an object or a string`,\n      {\n        [subpathValueTrace.join(\".\")]: subpathValue,\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n\nconst createSubpathKeysAreMixedWarning = ({\n  subpathValue,\n  subpathValueTrace,\n  packageInfo,\n  conditionalKeys,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_MIXED_KEYS\",\n    message: createDetailedMessage(\n      `unexpected keys in package.json exports: cannot mix relative and conditional keys`,\n      {\n        [subpathValueTrace.join(\".\")]: JSON.stringify(subpathValue, null, \"  \"),\n        \"unexpected keys\": conditionalKeys.map((key) => `\"${key}\"`).join(\"\\n\"),\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n\nconst createSubpathValueMustBeRelativeWarning = ({\n  value,\n  valueTrace,\n  packageInfo,\n}) => {\n  return {\n    code: \"EXPORTS_SUBPATH_VALUE_MUST_BE_RELATIVE\",\n    message: createDetailedMessage(\n      `unexpected value in package.json exports: value must be a relative to the package`,\n      {\n        [valueTrace.join(\".\")]: value,\n        \"package.json path\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n",
    "export const memoizeAsyncFunctionByUrl = (fn) => {\n  const cache = {}\n  return memoizeAsyncFunction(fn, {\n    getMemoryEntryFromArguments: ([url]) => {\n      return {\n        get: () => {\n          return cache[url]\n        },\n        set: (promise) => {\n          cache[url] = promise\n        },\n        delete: () => {\n          delete cache[url]\n        },\n      }\n    },\n  })\n}\n\nexport const memoizeAsyncFunctionBySpecifierAndImporter = (fn) => {\n  const importerCache = {}\n  return memoizeAsyncFunction(fn, {\n    getMemoryEntryFromArguments: ([specifier, importer]) => {\n      return {\n        get: () => {\n          const specifierCacheForImporter = importerCache[importer]\n          return specifierCacheForImporter\n            ? specifierCacheForImporter[specifier]\n            : null\n        },\n        set: (promise) => {\n          const specifierCacheForImporter = importerCache[importer]\n          if (specifierCacheForImporter) {\n            specifierCacheForImporter[specifier] = promise\n          } else {\n            importerCache[importer] = {\n              [specifier]: promise,\n            }\n          }\n        },\n        delete: () => {\n          const specifierCacheForImporter = importerCache[importer]\n          if (specifierCacheForImporter) {\n            delete specifierCacheForImporter[specifier]\n          }\n        },\n      }\n    },\n  })\n}\n\nconst memoizeAsyncFunction = (fn, { getMemoryEntryFromArguments }) => {\n  const memoized = async (...args) => {\n    const memoryEntry = getMemoryEntryFromArguments(args)\n    const promiseFromMemory = memoryEntry.get()\n    if (promiseFromMemory) {\n      return promiseFromMemory\n    }\n    const { promise, resolve, reject } = createControllablePromise()\n    memoryEntry.set(promise)\n    let value\n    let error\n    try {\n      value = fn(...args)\n      error = false\n    } catch (e) {\n      value = e\n      error = true\n      memoryEntry.delete()\n    }\n    if (error) {\n      reject(error)\n    } else {\n      resolve(value)\n    }\n    return promise\n  }\n  memoized.isInMemory = (...args) => {\n    return Boolean(getMemoryEntryFromArguments(args).get())\n  }\n  return memoized\n}\n\nconst createControllablePromise = () => {\n  let resolve\n  let reject\n  const promise = new Promise((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n  return { promise, resolve, reject }\n}\n",
    "import { readFile, urlToFileSystemPath } from \"@jsenv/filesystem\"\n\nexport const PACKAGE_NOT_FOUND = {}\nexport const PACKAGE_WITH_SYNTAX_ERROR = {}\n\nexport const readPackageFile = async (packageFileUrl) => {\n  try {\n    const packageObject = await readFile(packageFileUrl, { as: \"json\" })\n    return packageObject\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      return PACKAGE_NOT_FOUND\n    }\n\n    if (e.name === \"SyntaxError\") {\n      console.error(\n        formatPackageSyntaxErrorLog({ syntaxError: e, packageFileUrl }),\n      )\n      return PACKAGE_WITH_SYNTAX_ERROR\n    }\n\n    throw e\n  }\n}\n\nconst formatPackageSyntaxErrorLog = ({ syntaxError, packageFileUrl }) => {\n  return `\nerror while parsing package.json.\n--- syntax error message ---\n${syntaxError.message}\n--- package.json path ---\n${urlToFileSystemPath(packageFileUrl)}\n`\n}\n",
    "export const applyPackageManualOverride = (\n  packageObject,\n  packagesManualOverrides,\n) => {\n  const { name, version } = packageObject\n  const overrideKey = Object.keys(packagesManualOverrides).find(\n    (overrideKeyCandidate) => {\n      if (name === overrideKeyCandidate) {\n        return true\n      }\n      if (`${name}@${version}` === overrideKeyCandidate) {\n        return true\n      }\n      return false\n    },\n  )\n  if (overrideKey) {\n    return composeObject(packageObject, packagesManualOverrides[overrideKey])\n  }\n  return packageObject\n}\n\nconst composeObject = (leftObject, rightObject) => {\n  const composedObject = {\n    ...leftObject,\n  }\n  Object.keys(rightObject).forEach((key) => {\n    const rightValue = rightObject[key]\n\n    if (\n      rightValue === null ||\n      typeof rightValue !== \"object\" ||\n      key in leftObject === false\n    ) {\n      composedObject[key] = rightValue\n    } else {\n      const leftValue = leftObject[key]\n      if (leftValue === null || typeof leftValue !== \"object\") {\n        composedObject[key] = rightValue\n      } else {\n        composedObject[key] = composeObject(leftValue, rightValue)\n      }\n    }\n  })\n  return composedObject\n}\n",
    "import { firstOperationMatching } from \"@jsenv/cancellation\"\nimport { urlToRelativeUrl, resolveUrl } from \"@jsenv/filesystem\"\n\nimport { memoizeAsyncFunctionByUrl } from \"../memoizeAsyncFunction.js\"\nimport {\n  readPackageFile,\n  PACKAGE_NOT_FOUND,\n  PACKAGE_WITH_SYNTAX_ERROR,\n} from \"./readPackageFile.js\"\nimport { applyPackageManualOverride } from \"./applyPackageManualOverride.js\"\n\nexport const createFindNodeModulePackage = () => {\n  const readPackageFileMemoized = memoizeAsyncFunctionByUrl(\n    (packageFileUrl) => {\n      return readPackageFile(packageFileUrl)\n    },\n  )\n\n  return ({\n    projectDirectoryUrl,\n    packagesManualOverrides = {},\n    packageFileUrl,\n    dependencyName,\n  }) => {\n    const nodeModuleCandidates = getNodeModuleCandidates(\n      packageFileUrl,\n      projectDirectoryUrl,\n    )\n\n    return firstOperationMatching({\n      array: nodeModuleCandidates,\n      start: async (nodeModuleCandidate) => {\n        const packageFileUrlCandidate = `${projectDirectoryUrl}${nodeModuleCandidate}${dependencyName}/package.json`\n        const packageObjectCandidate = await readPackageFileMemoized(\n          packageFileUrlCandidate,\n        )\n\n        return {\n          packageFileUrl: packageFileUrlCandidate,\n          packageJsonObject: applyPackageManualOverride(\n            packageObjectCandidate,\n            packagesManualOverrides,\n          ),\n          syntaxError: packageObjectCandidate === PACKAGE_WITH_SYNTAX_ERROR,\n        }\n      },\n      predicate: ({ packageJsonObject }) => {\n        return packageJsonObject !== PACKAGE_NOT_FOUND\n      },\n    })\n  }\n}\n\nconst getNodeModuleCandidates = (fileUrl, projectDirectoryUrl) => {\n  const fileDirectoryUrl = resolveUrl(\"./\", fileUrl)\n\n  if (fileDirectoryUrl === projectDirectoryUrl) {\n    return [`node_modules/`]\n  }\n\n  const fileDirectoryRelativeUrl = urlToRelativeUrl(\n    fileDirectoryUrl,\n    projectDirectoryUrl,\n  )\n  const candidates = []\n  const relativeNodeModuleDirectoryArray =\n    fileDirectoryRelativeUrl.split(\"node_modules/\")\n  // remove the first empty string\n  relativeNodeModuleDirectoryArray.shift()\n\n  let i = relativeNodeModuleDirectoryArray.length\n  while (i--) {\n    candidates.push(\n      `node_modules/${relativeNodeModuleDirectoryArray\n        .slice(0, i + 1)\n        .join(\"node_modules/\")}node_modules/`,\n    )\n  }\n\n  return [...candidates, \"node_modules/\"]\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  readFile,\n  urlToRelativeUrl,\n  urlToFileSystemPath,\n} from \"@jsenv/filesystem\"\n\nimport { createPackageNameMustBeAStringWarning } from \"../logs.js\"\n\nimport { resolvePackageMain } from \"./resolvePackageMain.js\"\nimport { visitPackageImportMap } from \"./visitPackageImportMap.js\"\nimport { visitPackageImports } from \"./visitPackageImports.js\"\nimport { visitPackageExports } from \"./visitPackageExports.js\"\nimport { createFindNodeModulePackage } from \"./node-module-resolution.js\"\n\nexport const visitNodeModuleResolution = async ({\n  // nothing is actually listening for this cancellationToken for now\n  // it's not very important but it would be better to register on it\n  // an stops what we are doing if asked to do so\n  // cancellationToken = createCancellationTokenForProcess(),\n  logger,\n  warn,\n  projectDirectoryUrl,\n  visitors,\n  packagesManualOverrides,\n  exportsFieldWarningConfig,\n}) => {\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n  const findNodeModulePackage = createFindNodeModulePackage()\n\n  const seen = {}\n  const markPackageAsSeen = (packageFileUrl, importerPackageFileUrl) => {\n    if (packageFileUrl in seen) {\n      seen[packageFileUrl].push(importerPackageFileUrl)\n    } else {\n      seen[packageFileUrl] = [importerPackageFileUrl]\n    }\n  }\n  const packageIsSeen = (packageFileUrl, importerPackageFileUrl) => {\n    return (\n      packageFileUrl in seen &&\n      seen[packageFileUrl].includes(importerPackageFileUrl)\n    )\n  }\n\n  const visit = async ({\n    packageVisitors,\n    packageInfo,\n    packageImporterInfo,\n    isDevDependency,\n  }) => {\n    const packageName = packageInfo.object.name\n    if (typeof packageName !== \"string\") {\n      warn(\n        createPackageNameMustBeAStringWarning({\n          packageName,\n          packageInfo,\n        }),\n      )\n      // if package is root, we don't go further\n      // otherwise package name is deduced from file structure\n      // si it's thoerically safe to keep going\n      // in practice it should never happen because npm won't let\n      // a package without name be published\n      if (!packageImporterInfo) {\n        return\n      }\n    }\n\n    packageVisitors = packageVisitors.filter((visitor) => {\n      return (\n        !visitor.packageIncludedPredicate ||\n        visitor.packageIncludedPredicate(packageInfo, packageImporterInfo)\n      )\n    })\n    if (packageVisitors.length === 0) {\n      return\n    }\n\n    await visitDependencies({\n      packageVisitors,\n      packageInfo,\n      isDevDependency,\n    })\n\n    await visitPackage({\n      packageVisitors,\n      packageInfo,\n      packageImporterInfo,\n      isDevDependency,\n    })\n  }\n\n  const visitDependencies = async ({\n    packageVisitors,\n    packageInfo,\n    isDevDependency,\n  }) => {\n    const dependencyMap = packageDependenciesFromPackageObject(\n      packageInfo.object,\n    )\n\n    await Promise.all(\n      Object.keys(dependencyMap).map(async (dependencyName) => {\n        const dependencyInfo = dependencyMap[dependencyName]\n        if (dependencyInfo.type === \"devDependency\") {\n          if (packageInfo.url !== projectPackageFileUrl) {\n            return\n          }\n          const visitorsForDevDependencies = packageVisitors.filter(\n            (visitor) => {\n              return visitor.mappingsForDevDependencies\n            },\n          )\n          if (visitorsForDevDependencies.length === 0) {\n            return\n          }\n\n          await visitDependency({\n            packageVisitors: visitorsForDevDependencies,\n            packageInfo,\n            dependencyName,\n            dependencyInfo,\n            isDevDependency: true,\n          })\n          return\n        }\n\n        await visitDependency({\n          packageVisitors,\n          packageInfo,\n          dependencyName,\n          dependencyInfo,\n          isDevDependency,\n        })\n      }),\n    )\n  }\n\n  const visitDependency = async ({\n    packageVisitors,\n    packageInfo,\n    dependencyName,\n    dependencyInfo,\n    isDevDependency,\n  }) => {\n    const dependencyData = await findDependency({\n      packageFileUrl: packageInfo.url,\n      dependencyName,\n    })\n    if (!dependencyData) {\n      const cannotFindPackageWarning = createCannotFindPackageWarning({\n        dependencyName,\n        dependencyInfo,\n        packageInfo,\n      })\n      if (dependencyInfo.isOptional) {\n        logger.debug(cannotFindPackageWarning.message)\n      } else {\n        warn(cannotFindPackageWarning)\n      }\n      return\n    }\n    if (dependencyData.syntaxError) {\n      return\n    }\n\n    const {\n      packageFileUrl: dependencyPackageFileUrl,\n      packageJsonObject: dependencyPackageJsonObject,\n    } = dependencyData\n\n    if (packageIsSeen(dependencyPackageFileUrl, packageInfo.url)) {\n      return\n    }\n    markPackageAsSeen(dependencyPackageFileUrl, packageInfo.url)\n    await visit({\n      packageVisitors,\n      packageInfo: {\n        url: dependencyPackageFileUrl,\n        name: dependencyName,\n        object: dependencyPackageJsonObject,\n      },\n      packageImporterInfo: packageInfo,\n      isDevDependency,\n    })\n  }\n\n  const visitPackage = async ({\n    packageVisitors,\n    packageInfo,\n    packageImporterInfo,\n    isDevDependency,\n  }) => {\n    const packageDerivedInfo = computePackageDerivedInfo({\n      projectDirectoryUrl,\n      packageInfo,\n      packageImporterInfo,\n    })\n\n    const addImportMapForPackage = (visitor, importMap) => {\n      if (packageDerivedInfo.packageIsRoot) {\n        const { imports = {}, scopes = {} } = importMap\n        Object.keys(imports).forEach((from) => {\n          triggerVisitorOnMapping(visitor, {\n            from,\n            to: imports[from],\n          })\n        })\n        Object.keys(scopes).forEach((scope) => {\n          const scopeMappings = scopes[scope]\n          Object.keys(scopeMappings).forEach((key) => {\n            triggerVisitorOnMapping(visitor, {\n              scope,\n              from: key,\n              to: scopeMappings[key],\n            })\n          })\n        })\n        return\n      }\n\n      const { imports = {}, scopes = {} } = importMap\n      const scope = `./${packageDerivedInfo.packageDirectoryRelativeUrl}`\n      Object.keys(imports).forEach((from) => {\n        const to = imports[from]\n        const toMoved = moveMappingValue(\n          to,\n          packageInfo.url,\n          projectDirectoryUrl,\n        )\n        triggerVisitorOnMapping(visitor, {\n          scope,\n          from,\n          to: toMoved,\n        })\n      })\n      Object.keys(scopes).forEach((scope) => {\n        const scopeMappings = scopes[scope]\n        const scopeMoved = moveMappingValue(\n          scope,\n          packageInfo.url,\n          projectDirectoryUrl,\n        )\n        Object.keys(scopeMappings).forEach((key) => {\n          const to = scopeMappings[key]\n          const toMoved = moveMappingValue(\n            to,\n            packageInfo.url,\n            projectDirectoryUrl,\n          )\n          triggerVisitorOnMapping(visitor, {\n            scope: scopeMoved,\n            from: key,\n            to: toMoved,\n          })\n        })\n      })\n    }\n\n    const addMappingsForPackageAndImporter = (visitor, mappings) => {\n      if (packageDerivedInfo.packageIsRoot) {\n        Object.keys(mappings).forEach((from) => {\n          const to = mappings[from]\n          triggerVisitorOnMapping(visitor, {\n            from,\n            to,\n          })\n        })\n        return\n      }\n\n      if (packageDerivedInfo.importerIsRoot) {\n        // own package mappings available to himself\n        Object.keys(mappings).forEach((from) => {\n          const to = mappings[from]\n          triggerVisitorOnMapping(visitor, {\n            scope: `./${packageDerivedInfo.packageDirectoryRelativeUrl}`,\n            from,\n            to,\n          })\n          triggerVisitorOnMapping(visitor, { from, to })\n        })\n\n        // if importer is root no need to make package mappings available to the importer\n        // because they are already on top level mappings\n        return\n      }\n\n      Object.keys(mappings).forEach((from) => {\n        const to = mappings[from]\n        // own package exports available to himself\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${packageDerivedInfo.packageDirectoryRelativeUrl}`,\n          from,\n          to,\n        })\n        // now make package exports available to the importer\n        // here if the importer is himself we could do stuff\n        // we should even handle the case earlier to prevent top level remapping\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${packageDerivedInfo.importerRelativeUrl}`,\n          from,\n          to,\n        })\n      })\n    }\n\n    const importsFromPackageField = await visitPackageImportMap({\n      warn,\n      packageInfo,\n      projectDirectoryUrl,\n    })\n    packageVisitors.forEach((visitor) => {\n      addImportMapForPackage(visitor, importsFromPackageField)\n    })\n\n    if (\"imports\" in packageInfo.object) {\n      packageVisitors.forEach((visitor) => {\n        const packageImports = visitPackageImports({\n          warn,\n          packageInfo,\n          projectDirectoryUrl,\n          packageConditions: visitor.packageConditions,\n        })\n\n        const mappingsFromPackageImports = {}\n        Object.keys(packageImports).forEach((from) => {\n          const to = packageImports[from]\n          mappingsFromPackageImports[from] = to\n        })\n        addImportMapForPackage(visitor, {\n          imports: mappingsFromPackageImports,\n        })\n      })\n    }\n\n    if (\"exports\" in packageInfo.object) {\n      packageVisitors.forEach((visitor) => {\n        const packageExports = visitPackageExports({\n          projectDirectoryUrl,\n          warn,\n          packageInfo,\n          packageConditions: visitor.packageConditions,\n        })\n        const mappingsFromPackageExports = {}\n        Object.keys(packageExports).forEach((from) => {\n          const to = packageExports[from]\n          if (from.indexOf(\"*\") === -1) {\n            mappingsFromPackageExports[from] = to\n            return\n          }\n\n          if (\n            from.endsWith(\"/*\") &&\n            to.endsWith(\"/*\") &&\n            // ensure ends with '*' AND there is only one '*' occurence\n            to.indexOf(\"*\") === to.length - 1\n          ) {\n            const fromWithouTrailingStar = from.slice(0, -1)\n            const toWithoutTrailingStar = to.slice(0, -1)\n            mappingsFromPackageExports[fromWithouTrailingStar] =\n              toWithoutTrailingStar\n            return\n          }\n\n          logger.debug(\n            createExportsWildcardIgnoredWarning({\n              key: from,\n              value: to,\n              packageInfo,\n            }),\n          )\n        })\n        addMappingsForPackageAndImporter(visitor, mappingsFromPackageExports)\n      })\n    } else {\n      // no \"exports\" field means any file can be imported\n      // -> generate a mapping to allow this\n      // https://nodejs.org/docs/latest-v15.x/api/packages.html#packages_name\n      const packageDirectoryRelativeUrl = urlToRelativeUrl(\n        resolveUrl(\"./\", packageInfo.url),\n        projectDirectoryUrl,\n      )\n      packageVisitors.forEach((visitor) => {\n        addMappingsForPackageAndImporter(visitor, {\n          [`${packageInfo.name}/`]: `./${packageDirectoryRelativeUrl}`,\n        })\n      })\n\n      // visit \"main\" only if there is no \"exports\"\n      // https://nodejs.org/docs/latest-v16.x/api/packages.html#packages_main\n      await visitPackageMain({\n        packageVisitors,\n        packageInfo,\n        packageDerivedInfo,\n        isDevDependency,\n      })\n    }\n  }\n\n  const visitPackageMain = async ({\n    packageVisitors,\n    packageInfo,\n    packageDerivedInfo,\n    isDevDependency,\n  }) => {\n    const {\n      packageIsRoot,\n      importerIsRoot,\n      importerRelativeUrl,\n      packageDirectoryUrl,\n      packageDirectoryUrlExpected,\n    } = packageDerivedInfo\n\n    await packageVisitors.reduce(async (previous, visitor) => {\n      await previous\n      const exportsFieldSeverity = shouldWarnAboutExportsField({\n        exportsFieldWarningConfig,\n        isDevDependency,\n      })\n        ? \"warn\"\n        : \"debug\"\n      const mainResolutionInfo = await resolvePackageMain({\n        logger,\n        warn,\n        exportsFieldSeverity,\n        packageInfo,\n        packageConditions: visitor.packageConditions,\n      })\n\n      if (!mainResolutionInfo.found) {\n        const { warning } = mainResolutionInfo\n        // main explicitely disabled\n        if (packageInfo.object.main === \"\") {\n          return\n        }\n\n        // main \"should\" be there but if we warn there is many false positive\n        // when package have no main file and that's expected\n        if (packageInfo.object.main === undefined) {\n          logger.debug(warning.message)\n        } else {\n          // we don't know yet if the codebase will rely on main file presence or not\n          // so when main does not lead to a file:\n          // - a warning is logged\n          // - we still generate the mapping\n          warn(warning)\n        }\n      }\n\n      const mainFileRelativeUrl = urlToRelativeUrl(\n        resolveUrl(mainResolutionInfo.relativeUrl, packageInfo.url),\n        projectDirectoryUrl,\n      )\n      const scope =\n        packageIsRoot || importerIsRoot ? null : `./${importerRelativeUrl}`\n      const from = packageInfo.name\n      const to = `./${mainFileRelativeUrl}`\n\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from,\n        to,\n      })\n\n      if (packageDirectoryUrl !== packageDirectoryUrlExpected) {\n        triggerVisitorOnMapping(visitor, {\n          scope: `./${importerRelativeUrl}`,\n          from,\n          to,\n        })\n      }\n    }, Promise.resolve())\n  }\n\n  const dependenciesCache = {}\n  const findDependency = ({ packageFileUrl, dependencyName }) => {\n    if (packageFileUrl in dependenciesCache === false) {\n      dependenciesCache[packageFileUrl] = {}\n    }\n    if (dependencyName in dependenciesCache[packageFileUrl]) {\n      return dependenciesCache[packageFileUrl][dependencyName]\n    }\n    const dependencyPromise = findNodeModulePackage({\n      projectDirectoryUrl,\n      packageFileUrl,\n      dependencyName,\n      packagesManualOverrides,\n    })\n    dependenciesCache[packageFileUrl][dependencyName] = dependencyPromise\n    return dependencyPromise\n  }\n\n  let projectPackageObject\n  try {\n    projectPackageObject = await readFile(projectPackageFileUrl, { as: \"json\" })\n  } catch (e) {\n    if (e.code === \"ENOENT\") {\n      const error = new Error(\n        createDetailedMessage(`Cannot find project package.json file.`, {\n          \"package.json url\": projectPackageFileUrl,\n        }),\n      )\n      error.code = \"PROJECT_PACKAGE_FILE_NOT_FOUND\"\n      throw error\n    }\n    throw e\n  }\n\n  const importerPackageFileUrl = projectPackageFileUrl\n  markPackageAsSeen(projectPackageFileUrl, importerPackageFileUrl)\n  await visit({\n    packageInfo: {\n      url: projectPackageFileUrl,\n      name: projectPackageObject.name,\n      object: projectPackageObject,\n    },\n    packageImporterInfo: null,\n    packageVisitors: visitors,\n    isDevDependency: false,\n  })\n}\n\nconst triggerVisitorOnMapping = (visitor, { scope, from, to }) => {\n  if (scope) {\n    // when a package says './' maps to './'\n    // we add something to say if we are already inside the package\n    // no need to ensure leading slash are scoped to the package\n    if (from === \"./\" && to === scope) {\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from: scope,\n        to: scope,\n      })\n      const packageName = scope.slice(\n        scope.lastIndexOf(\"node_modules/\") + `node_modules/`.length,\n      )\n      triggerVisitorOnMapping(visitor, {\n        scope,\n        from: packageName,\n        to: scope,\n      })\n    }\n\n    visitor.onMapping({\n      scope,\n      from,\n      to,\n    })\n    return\n  }\n\n  // we could think it's useless to remap from with to\n  // however it can be used to ensure a weaker remapping\n  // does not win over this specific file or folder\n  if (from === to) {\n    /**\n     * however remapping '/' to '/' is truly useless\n     * moreover it would make wrapImportMap create something like\n     * {\n     *   imports: {\n     *     \"/\": \"/.dist/best/\"\n     *   }\n     * }\n     * that would append the wrapped folder twice\n     * */\n    if (from === \"/\") return\n  }\n  visitor.onMapping({ from, to })\n}\n\nconst packageDependenciesFromPackageObject = (packageObject) => {\n  const packageDependencies = {}\n\n  const { dependencies = {} } = packageObject\n  // https://npm.github.io/using-pkgs-docs/package-json/types/optionaldependencies.html\n  const { optionalDependencies = {} } = packageObject\n  Object.keys(dependencies).forEach((dependencyName) => {\n    packageDependencies[dependencyName] = {\n      type: \"dependency\",\n      isOptional: dependencyName in optionalDependencies,\n      versionPattern: dependencies[dependencyName],\n    }\n  })\n\n  const { peerDependencies = {} } = packageObject\n  const { peerDependenciesMeta = {} } = packageObject\n  Object.keys(peerDependencies).forEach((dependencyName) => {\n    packageDependencies[dependencyName] = {\n      type: \"peerDependency\",\n      versionPattern: peerDependencies[dependencyName],\n      isOptional:\n        dependencyName in peerDependenciesMeta &&\n        peerDependenciesMeta[dependencyName].optional,\n    }\n  })\n\n  const { devDependencies = {} } = packageObject\n  Object.keys(devDependencies).forEach((dependencyName) => {\n    if (!packageDependencies.hasOwnProperty(dependencyName)) {\n      packageDependencies[dependencyName] = {\n        type: \"devDependency\",\n        versionPattern: devDependencies[dependencyName],\n      }\n    }\n  })\n\n  return packageDependencies\n}\n\nconst moveMappingValue = (address, from, to) => {\n  const url = resolveUrl(address, from)\n  const relativeUrl = urlToRelativeUrl(url, to)\n  if (relativeUrl.startsWith(\"../\")) {\n    return relativeUrl\n  }\n  if (relativeUrl.startsWith(\"./\")) {\n    return relativeUrl\n  }\n  if (/^[a-zA-Z]{2,}:/.test(relativeUrl)) {\n    // has sheme\n    return relativeUrl\n  }\n  return `./${relativeUrl}`\n}\n\nconst computePackageDerivedInfo = ({\n  projectDirectoryUrl,\n  packageInfo,\n  packageImporterInfo,\n}) => {\n  if (!packageImporterInfo) {\n    const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n    urlToRelativeUrl(packageDirectoryUrl, projectDirectoryUrl)\n\n    return {\n      importerIsRoot: false,\n      importerRelativeUrl: \"\",\n      packageIsRoot: true,\n      packageDirectoryUrl,\n      packageDirectoryUrlExpected: packageDirectoryUrl,\n      packageDirectoryRelativeUrl: urlToRelativeUrl(\n        packageDirectoryUrl,\n        projectDirectoryUrl,\n      ),\n    }\n  }\n\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n\n  const importerIsRoot = packageImporterInfo.url === projectPackageFileUrl\n\n  const importerPackageDirectoryUrl = resolveUrl(\"./\", packageImporterInfo.url)\n\n  const importerRelativeUrl = urlToRelativeUrl(\n    importerPackageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n\n  const packageIsRoot = packageInfo.url === projectPackageFileUrl\n\n  const packageDirectoryUrl = resolveUrl(\"./\", packageInfo.url)\n\n  const packageDirectoryUrlExpected = `${importerPackageDirectoryUrl}node_modules/${packageInfo.name}/`\n\n  const packageDirectoryRelativeUrl = urlToRelativeUrl(\n    packageDirectoryUrl,\n    projectDirectoryUrl,\n  )\n\n  return {\n    importerIsRoot,\n    importerRelativeUrl,\n    packageIsRoot,\n    packageDirectoryUrl,\n    packageDirectoryUrlExpected,\n    packageDirectoryRelativeUrl,\n  }\n}\n\nconst shouldWarnAboutExportsField = ({\n  exportsFieldWarningConfig,\n  isDevDependency,\n}) => {\n  if (!exportsFieldWarningConfig) {\n    return false\n  }\n\n  if (isDevDependency) {\n    return exportsFieldWarningConfig.devDependencies\n  }\n\n  return exportsFieldWarningConfig.dependencies\n}\n\nconst createExportsWildcardIgnoredWarning = ({ key, value, packageInfo }) => {\n  return {\n    code: \"EXPORTS_WILDCARD\",\n    message: `Ignoring export using \"*\" because it is not supported by importmap.\n--- key ---\n${key}\n--- value ---\n${value}\n--- package.json path ---\n${urlToFileSystemPath(packageInfo.url)}\n--- see also ---\nhttps://github.com/WICG/import-maps/issues/232`,\n  }\n}\n\nconst createCannotFindPackageWarning = ({\n  dependencyName,\n  dependencyInfo,\n  packageInfo,\n}) => {\n  const dependencyIsOptional = dependencyInfo.isOptional\n  const dependencyType = dependencyInfo.type\n  const dependencyVersionPattern = dependencyInfo.versionPattern\n  return {\n    code: \"CANNOT_FIND_PACKAGE\",\n    message: createDetailedMessage(\n      dependencyIsOptional\n        ? `cannot find an optional ${dependencyType}.`\n        : `cannot find a ${dependencyType}.`,\n      {\n        [dependencyType]: `${dependencyName}@${dependencyVersionPattern}`,\n        \"required by\": urlToFileSystemPath(packageInfo.url),\n      },\n    ),\n  }\n}\n",
    "export const optimizeImportMap = ({ imports, scopes }) => {\n  // remove useless duplicates (scoped key+value already defined on imports)\n  const scopesOptimized = {}\n  Object.keys(scopes).forEach((scope) => {\n    const scopeMappings = scopes[scope]\n    const scopeMappingsOptimized = {}\n    Object.keys(scopeMappings).forEach((mappingKey) => {\n      const topLevelMappingValue = imports[mappingKey]\n      const mappingValue = scopeMappings[mappingKey]\n      if (!topLevelMappingValue || topLevelMappingValue !== mappingValue) {\n        scopeMappingsOptimized[mappingKey] = mappingValue\n      }\n    })\n    if (Object.keys(scopeMappingsOptimized).length > 0) {\n      scopesOptimized[scope] = scopeMappingsOptimized\n    }\n  })\n  return { imports, scopes: scopesOptimized }\n}\n",
    "import { createDetailedMessage } from \"@jsenv/logger\"\nimport {\n  resolveUrl,\n  readFile,\n  readFileSystemNodeStat,\n  urlToRelativeUrl,\n} from \"@jsenv/filesystem\"\n\nimport { createPackageNameMustBeAStringWarning } from \"../logs.js\"\nimport { packageConditionsFromPackageUserConditions } from \"../package_conditions.js\"\nimport { visitPackageExports } from \"../from-package/visitPackageExports.js\"\nimport { resolvePackageMain } from \"../from-package/resolvePackageMain.js\"\n\nconst entryPointResolutionFailureMessage = `Cannot find project entry point`\n\nexport const resolveProjectEntryPoint = async ({\n  logger,\n  projectDirectoryUrl,\n  warn,\n  packageUserConditions,\n  runtime,\n}) => {\n  const packageConditions = packageConditionsFromPackageUserConditions({\n    runtime,\n    packageUserConditions,\n  })\n\n  const projectPackageFileUrl = resolveUrl(\n    \"./package.json\",\n    projectDirectoryUrl,\n  )\n  const projectPackageObject = await readFile(projectPackageFileUrl, {\n    as: \"json\",\n  })\n  const projectPackageName = projectPackageObject.name\n  if (typeof projectPackageName !== \"string\") {\n    warn(\n      createPackageNameMustBeAStringWarning({\n        packageName: projectPackageName,\n        packageFileUrl: projectPackageFileUrl,\n      }),\n    )\n    return null\n  }\n\n  const projectPackageInfo = {\n    name: projectPackageName,\n    url: projectPackageFileUrl,\n    object: projectPackageObject,\n  }\n\n  if (\"exports\" in projectPackageObject) {\n    const packageExports = projectPackageObject.exports\n\n    if (packageExports === false || packageExports === null) {\n      warn({\n        code: \"PROJECT_ENTRY_POINT_RESOLUTION_FAILED\",\n        message: createDetailedMessage(entryPointResolutionFailureMessage, {\n          reason: `explicitely disabled in package.json (\"exports\" is ${packageExports})`,\n        }),\n      })\n      return null\n    }\n\n    if (typeof packageExports === \"string\") {\n      return tryExportSubpath({\n        warn,\n        exportSubpath: packageExports,\n        projectPackageFileUrl,\n      })\n    }\n\n    const packageSubpaths = visitPackageExports({\n      projectDirectoryUrl,\n      warn,\n      packageInfo: projectPackageInfo,\n      packageExports,\n      packageConditions,\n    })\n    const subpathKey = Object.keys(packageSubpaths).find(\n      (from) => from === projectPackageName,\n    )\n    if (!subpathKey) {\n      warn({\n        code: \"PROJECT_ENTRY_POINT_RESOLUTION_FAILED\",\n        message: createDetailedMessage(entryPointResolutionFailureMessage, {\n          reason: `no subpath found in package.json \"exports\"`,\n        }),\n      })\n      return null\n    }\n    return tryExportSubpath({\n      warn,\n      exportSubpath: packageSubpaths[subpathKey],\n      projectPackageFileUrl,\n    })\n  }\n\n  // visit \"main\" only if there is no \"exports\"\n  // https://nodejs.org/docs/latest-v16.x/api/packages.html#packages_main\n  const main = projectPackageObject.main\n  if (main === \"\") {\n    warn({\n      code: \"PROJECT_ENTRY_POINT_RESOLUTION_FAILED\",\n      message: createDetailedMessage(entryPointResolutionFailureMessage, {\n        reason: `explicitely disabled in package.json (\"main\" is an empty string)`,\n      }),\n    })\n    return null\n  }\n\n  const packageMainResolutionInfo = await resolvePackageMain({\n    logger,\n    warn,\n    packageInfo: projectPackageInfo,\n    packageConditions,\n  })\n  if (!packageMainResolutionInfo.found) {\n    warn({\n      code: \"PROJECT_ENTRY_POINT_RESOLUTION_FAILED\",\n      message: createDetailedMessage(entryPointResolutionFailureMessage, {\n        reason: packageMainResolutionInfo.warning.message,\n      }),\n    })\n    return null\n  }\n\n  return packageMainResolutionInfo.relativeUrl\n}\n\nconst tryExportSubpath = async ({\n  warn,\n  exportSubpath,\n  projectPackageFileUrl,\n}) => {\n  const subpathUrl = resolveUrl(exportSubpath, projectPackageFileUrl)\n  const filesystemStat = await readFileSystemNodeStat(subpathUrl, {\n    nullIfNotFound: true,\n  })\n  if (filesystemStat === null || !filesystemStat.isFile()) {\n    warn({\n      code: \"PROJECT_ENTRY_POINT_RESOLUTION_FAILED\",\n      message: createDetailedMessage(entryPointResolutionFailureMessage, {\n        reason: `file not found for \"${exportSubpath}\" declared in package.json \"exports\"`,\n      }),\n    })\n    return null\n  }\n  return urlToRelativeUrl(subpathUrl, projectPackageFileUrl)\n}\n",
    "/* global __filename */\n\nconst filenameContainsBackSlashes = __filename.indexOf(\"\\\\\") > -1\n\nconst url = filenameContainsBackSlashes\n  ? `file:///${__filename.replace(/\\\\/g, \"/\")}`\n  : `file://${__filename}`\n\nexport default url\n",
    "import { createRequire } from \"node:module\"\nimport { parseAsync } from \"@babel/core\"\nimport { urlToFileSystemPath } from \"@jsenv/filesystem\"\n\nconst require = createRequire(import.meta.url)\n\nconst traverse = require(\"@babel/traverse\")\n\nexport const parseImportSpecifiers = async (\n  url,\n  { urlResponseText, babelOptions } = {},\n) => {\n  const ast = await parseAsync(urlResponseText, {\n    ...babelOptions,\n    sourceType: \"module\",\n    filename: url.startsWith(\"file://\") ? urlToFileSystemPath(url) : url,\n    plugins: babelOptions.plugins,\n    // ranges: true,\n    parserOpts: {\n      ranges: true,\n    },\n  })\n\n  const specifiers = {}\n\n  const addSpecifier = ({ path, type }) => {\n    const specifier = path.node.value\n    specifiers[specifier] = {\n      line: path.node.loc.start.line,\n      column: path.node.loc.start.column,\n      type,\n    }\n  }\n\n  traverse.default(ast, {\n    // \"ImportExpression is replaced with a CallExpression whose callee is an Import node.\"\n    // https://babeljs.io/docs/en/babel-parser#output\n    // ImportExpression: (path) => {\n    //   if (path.node.arguments[0].type !== \"StringLiteral\") {\n    //     // Non-string argument, probably a variable or expression, e.g.\n    //     // import(moduleId)\n    //     // import('./' + moduleName)\n    //     return\n    //   }\n    //   addSpecifier(path.get(\"arguments\")[0])\n    // },\n    CallExpression: (path) => {\n      if (path.node.callee.type !== \"Import\") {\n        // Some other function call, not import();\n        return\n      }\n      if (path.node.arguments[0].type !== \"StringLiteral\") {\n        // Non-string argument, probably a variable or expression, e.g.\n        // import(moduleId)\n        // import('./' + moduleName)\n        return\n      }\n      addSpecifier({\n        path: path.get(\"arguments\")[0],\n        type: \"import-dynamic\",\n      })\n    },\n    ExportAllDeclaration: (path) => {\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"export-all\",\n      })\n    },\n    ExportNamedDeclaration: (path) => {\n      if (!path.node.source) {\n        // This export has no \"source\", so it's probably\n        // a local variable or function, e.g.\n        // export { varName }\n        // export const constName = ...\n        // export function funcName() {}\n        return\n      }\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"export-named\",\n      })\n    },\n    ImportDeclaration: (path) => {\n      addSpecifier({\n        path: path.get(\"source\"),\n        type: \"import-static\",\n      })\n    },\n  })\n\n  return specifiers\n}\n",
    "// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/css-syntax-error.js#L43\n// https://github.com/postcss/postcss/blob/fd30d3df5abc0954a0ec642a3cdc644ab2aacf9c/lib/terminal-highlight.js#L50\n// https://github.com/babel/babel/blob/eea156b2cb8deecfcf82d52aa1b71ba4995c7d68/packages/babel-code-frame/src/index.js#L1\n\nexport const showSource = ({ url, line, column, source }) => {\n  let message = \"\"\n\n  message += typeof url === \"undefined\" ? \"Anonymous\" : url\n  if (typeof line !== \"number\") {\n    return message\n  }\n\n  message += `:${line}`\n  if (typeof column === \"number\") {\n    message += `:${column}`\n  }\n\n  if (!source) {\n    return message\n  }\n\n  return `${message}\n${showSourceLocation(source, {\n  line,\n  column,\n})}`\n}\n\nconst red = \"\\x1b[31m\"\nconst grey = \"\\x1b[39m\"\nconst ansiResetSequence = \"\\x1b[0m\"\n\nconst showSourceLocation = (\n  source,\n  {\n    line,\n    column,\n    numberOfSurroundingLinesToShow = 1,\n    lineMaxLength = 120,\n    color = false,\n    markColor = red,\n    asideColor = grey,\n    colorMark = (string) => `${markColor}${string}${ansiResetSequence}`,\n    colorAside = (string) => `${asideColor}${string}${ansiResetSequence}`,\n  },\n) => {\n  const mark = color ? colorMark : (string) => string\n  const aside = color ? colorAside : (string) => string\n\n  const lines = source.split(/\\r?\\n/)\n  let lineRange = {\n    start: line - 1,\n    end: line,\n  }\n  lineRange = moveLineRangeUp(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = moveLineRangeDown(lineRange, numberOfSurroundingLinesToShow)\n  lineRange = lineRangeWithinLines(lineRange, lines)\n  const linesToShow = lines.slice(lineRange.start, lineRange.end)\n  const endLineNumber = lineRange.end\n  const lineNumberMaxWidth = String(endLineNumber).length\n\n  const columnRange = {}\n  if (column === undefined) {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  } else if (column > lineMaxLength) {\n    columnRange.start = column - Math.floor(lineMaxLength / 2)\n    columnRange.end = column + Math.ceil(lineMaxLength / 2)\n  } else {\n    columnRange.start = 0\n    columnRange.end = lineMaxLength\n  }\n\n  return linesToShow.map((lineSource, index) => {\n    const lineNumber = lineRange.start + index + 1\n    const isMainLine = lineNumber === line\n    const lineSourceTruncated = applyColumnRange(columnRange, lineSource)\n    const lineNumberWidth = String(lineNumber).length\n    // ensure if line moves from 7,8,9 to 10 the display is still great\n    const lineNumberRightSpacing = \" \".repeat(\n      lineNumberMaxWidth - lineNumberWidth,\n    )\n    const asideSource = `${lineNumber}${lineNumberRightSpacing} |`\n    const lineFormatted = `${aside(asideSource)} ${lineSourceTruncated}`\n    if (isMainLine) {\n      if (column === undefined) {\n        return `${mark(\">\")} ${lineFormatted}`\n      }\n      const lineSourceUntilColumn = lineSourceTruncated.slice(\n        0,\n        column - columnRange.start,\n      )\n      const spacing = stringToSpaces(lineSourceUntilColumn)\n      const mainLineFormatted = `${mark(\">\")} ${lineFormatted}\n  ${\" \".repeat(lineNumberWidth)} ${aside(\"|\")}${spacing}${mark(\"^\")}`\n      return mainLineFormatted\n    }\n    return `  ${lineFormatted}`\n  }).join(`\n`)\n}\n\nconst applyColumnRange = ({ start, end }, line) => {\n  if (typeof start !== \"number\") {\n    throw new TypeError(`start must be a number, received ${start}`)\n  }\n  if (typeof end !== \"number\") {\n    throw new TypeError(`end must be a number, received ${end}`)\n  }\n  if (end < start) {\n    throw new Error(\n      `end must be greater than start, but ${end} is smaller than ${start}`,\n    )\n  }\n\n  const prefix = \"\"\n  const suffix = \"\"\n  const lastIndex = line.length\n\n  if (line.length === 0) {\n    // don't show any ellipsis if the line is empty\n    // because it's not truncated in that case\n    return \"\"\n  }\n\n  const startTruncated = start > 0\n  const endTruncated = lastIndex > end\n\n  let from = startTruncated ? start + prefix.length : start\n  let to = endTruncated ? end - suffix.length : end\n  if (to > lastIndex) to = lastIndex\n\n  if (start >= lastIndex || from === to) {\n    return \"\"\n  }\n\n  let result = \"\"\n  while (from < to) {\n    result += line[from]\n    from++\n  }\n\n  if (result.length === 0) {\n    return \"\"\n  }\n  if (startTruncated && endTruncated) {\n    return `${prefix}${result}${suffix}`\n  }\n  if (startTruncated) {\n    return `${prefix}${result}`\n  }\n  if (endTruncated) {\n    return `${result}${suffix}`\n  }\n  return result\n}\n\nconst stringToSpaces = (string) => string.replace(/[^\\t]/g, \" \")\n\n// const getLineRangeLength = ({ start, end }) => end - start\n\nconst moveLineRangeUp = ({ start, end }, number) => {\n  return {\n    start: start - number,\n    end,\n  }\n}\n\nconst moveLineRangeDown = ({ start, end }, number) => {\n  return {\n    start,\n    end: end + number,\n  }\n}\n\nconst lineRangeWithinLines = ({ start, end }, lines) => {\n  return {\n    start: start < 0 ? 0 : start,\n    end: end > lines.length ? lines.length : end,\n  }\n}\n",
    "import { loadOptionsAsync } from \"@babel/core\"\n\nimport {\n  resolveUrl,\n  readFile,\n  urlToExtension,\n  urlToRelativeUrl,\n  urlIsInsideOf,\n  urlToFileSystemPath,\n} from \"@jsenv/filesystem\"\nimport {\n  normalizeImportMap,\n  resolveImport,\n  composeTwoImportMaps,\n} from \"@jsenv/importmap\"\nimport { isSpecifierForNodeCoreModule } from \"@jsenv/importmap/src/isSpecifierForNodeCoreModule.js\"\n\nimport {\n  memoizeAsyncFunctionByUrl,\n  memoizeAsyncFunctionBySpecifierAndImporter,\n} from \"../memoizeAsyncFunction.js\"\n\nimport { parseImportSpecifiers } from \"./parseImportSpecifiers.js\"\nimport { showSource } from \"./showSource.js\"\nimport { resolveFile } from \"../resolveFile.js\"\nimport {\n  createBareSpecifierAutomappingMessage,\n  createExtensionLessAutomappingMessage,\n  createImportResolutionFailedWarning,\n} from \"../logs.js\"\n\nexport const visitSourceFiles = async ({\n  logger,\n  warn,\n  projectDirectoryUrl,\n  projectEntryPoint,\n  runtime,\n  importMap,\n  bareSpecifierAutomapping,\n  extensionlessAutomapping,\n  magicExtensions, //  = [\".js\", \".jsx\", \".ts\", \".tsx\", \".node\", \".json\"],\n  removeUnusedMappings,\n}) => {\n  const imports = {}\n  const scopes = {}\n  const addMapping = ({ scope, from, to }) => {\n    if (scope) {\n      scopes[scope] = {\n        ...(scopes[scope] || {}),\n        [from]: to,\n      }\n    } else {\n      imports[from] = to\n    }\n  }\n\n  const topLevelMappingsUsed = []\n  const scopedMappingsUsed = {}\n  const markMappingAsUsed = ({ scope, from, to }) => {\n    if (scope) {\n      if (scope in scopedMappingsUsed) {\n        scopedMappingsUsed[scope].push({ from, to })\n      } else {\n        scopedMappingsUsed[scope] = [{ from, to }]\n      }\n    } else {\n      topLevelMappingsUsed.push({ from, to })\n    }\n  }\n\n  const baseUrl =\n    runtime === \"browser\"\n      ? fileUrlToHttpUrl(projectDirectoryUrl, {\n          projectDirectoryUrl,\n          baseUrl: \"http://jsenv.com\",\n        })\n      : projectDirectoryUrl\n\n  // https://babeljs.io/docs/en/babel-core#loadoptions\n  const babelOptions = await loadOptionsAsync({\n    root: urlToFileSystemPath(projectDirectoryUrl),\n  })\n\n  const importResolver = createImportResolver({\n    logger,\n    warn,\n    runtime,\n    importMap,\n    projectDirectoryUrl,\n    baseUrl,\n    bareSpecifierAutomapping,\n    extensionlessAutomapping,\n    magicExtensions,\n    onImportMapping: ({ scope, from }) => {\n      if (scope) {\n        // make scope relative again\n        scope = `./${urlToRelativeUrl(scope, baseUrl)}`\n        // make from relative again\n        if (from.startsWith(baseUrl)) {\n          from = `./${urlToRelativeUrl(from, baseUrl)}`\n        }\n      }\n\n      markMappingAsUsed({\n        scope,\n        from,\n        to: scope ? importMap.scopes[scope][from] : importMap.imports[from],\n      })\n    },\n    performAutomapping: (automapping) => {\n      addMapping(automapping)\n      markMappingAsUsed(automapping)\n    },\n  })\n\n  const visitUrl = memoizeAsyncFunctionBySpecifierAndImporter(\n    async (specifier, importer, { importedBy }) => {\n      const { found, ignore, url, body } =\n        await importResolver.applyImportResolution({\n          specifier,\n          importer,\n          importedBy,\n        })\n\n      if (!found || ignore) {\n        return\n      }\n\n      if (!visitUrlResponse.isInMemory(url)) {\n        await visitUrlResponse(url, { body })\n      }\n    },\n  )\n\n  const visitUrlResponse = memoizeAsyncFunctionByUrl(async (url, { body }) => {\n    const specifiers = await parseImportSpecifiers(url, {\n      urlResponseText: body,\n      babelOptions,\n    })\n    const fileUrl =\n      httpUrlToFileUrl(url, { projectDirectoryUrl, baseUrl }) || url\n    await Promise.all(\n      Object.keys(specifiers).map(async (specifier) => {\n        const specifierInfo = specifiers[specifier]\n        await visitUrl(specifier, url, {\n          importedBy: showSource({\n            url: fileUrl,\n            line: specifierInfo.line,\n            column: specifierInfo.column,\n            source: body,\n          }),\n        })\n      }),\n    )\n  })\n\n  await visitUrl(`./${projectEntryPoint}`, baseUrl, {\n    importedBy: \"project package.json\",\n  })\n\n  if (removeUnusedMappings) {\n    const importsUsed = {}\n    topLevelMappingsUsed.forEach(({ from, to }) => {\n      importsUsed[from] = to\n    })\n    const scopesUsed = {}\n    Object.keys(scopedMappingsUsed).forEach((scope) => {\n      const mappingsUsed = scopedMappingsUsed[scope]\n      const scopedMappings = {}\n      mappingsUsed.forEach(({ from, to }) => {\n        scopedMappings[from] = to\n      })\n      scopesUsed[scope] = scopedMappings\n    })\n    return {\n      imports: importsUsed,\n      scopes: scopesUsed,\n    }\n  }\n\n  return composeTwoImportMaps(importMap, { imports, scopes })\n}\n\nconst createImportResolver = ({\n  logger,\n  warn,\n  runtime,\n  importMap,\n  baseUrl,\n  projectDirectoryUrl,\n  bareSpecifierAutomapping,\n  extensionlessAutomapping,\n  magicExtensions,\n  onImportMapping,\n  performAutomapping,\n}) => {\n  const importMapNormalized = normalizeImportMap(importMap, baseUrl)\n  const BARE_SPECIFIER_ERROR = {}\n\n  const applyImportResolution = async ({ specifier, importer, importedBy }) => {\n    if (runtime === \"node\" && isSpecifierForNodeCoreModule(specifier)) {\n      return {\n        found: true,\n        ignore: true,\n      }\n    }\n\n    const { gotBareSpecifierError, importUrl } = resolveImportUrl({\n      specifier,\n      importer,\n    })\n\n    const importFileUrl = httpUrlToFileUrl(importUrl, {\n      projectDirectoryUrl,\n      baseUrl,\n    })\n\n    if (importFileUrl) {\n      return handleFileUrl({\n        specifier,\n        importer,\n        importedBy,\n        gotBareSpecifierError,\n        importUrl: importFileUrl,\n      })\n    }\n\n    if (importUrl.startsWith(\"http:\") || importUrl.startsWith(\"https:\")) {\n      return handleHttpUrl()\n    }\n\n    return handleFileUrl({\n      specifier,\n      importer,\n      importedBy,\n      gotBareSpecifierError,\n      importUrl,\n    })\n  }\n\n  const resolveImportUrl = ({ specifier, importer }) => {\n    try {\n      const importUrl = resolveImport({\n        specifier,\n        importer,\n        importMap: importMapNormalized,\n        defaultExtension: false,\n        onImportMapping,\n        createBareSpecifierError: () => BARE_SPECIFIER_ERROR,\n      })\n\n      return {\n        gotBareSpecifierError: false,\n        importUrl,\n      }\n    } catch (e) {\n      return {\n        gotBareSpecifierError: true,\n        importUrl: resolveUrl(specifier, importer),\n      }\n    }\n  }\n\n  const handleHttpUrl = async () => {\n    // NICE TO HAVE: perform an http request and check for 404 and things like that\n    // the day we do the http request, this function would return both\n    // if the file is found and the file content\n    // because once http request is done we can await response body\n    // CURRENT BEHAVIOUR: consider http url as found without checking\n    return {\n      found: true,\n      ignore: true,\n      body: null,\n    }\n  }\n\n  const foundFileUrl = async (url) => {\n    const extension = urlToExtension(url)\n    const isJs = [\".js\", \".jsx\", \".ts\", \".tsx\", \".mjs\", \".cjs\"].includes(\n      extension,\n    )\n    const httpUrl = fileUrlToHttpUrl(url, { projectDirectoryUrl, baseUrl })\n\n    if (isJs) {\n      return {\n        found: true,\n        url: httpUrl || url,\n        body: await readFile(url, { as: \"string\" }),\n      }\n    }\n\n    return {\n      found: true,\n      ignore: true,\n      url: httpUrl || url,\n    }\n  }\n\n  const handleFileUrl = async ({\n    specifier,\n    importer,\n    importedBy,\n    gotBareSpecifierError,\n    importUrl,\n  }) => {\n    const { magicExtension, found, url } = await resolveFile(importUrl, {\n      magicExtensionEnabled: true,\n      magicExtensions: magicExtensionWithImporterExtension(\n        magicExtensions || [],\n        importer,\n      ),\n    })\n\n    const importerUrl = httpUrlToFileUrl(importer, {\n      projectDirectoryUrl,\n      baseUrl,\n    })\n    const importerPackageDirectoryUrl = packageDirectoryUrlFromUrl(\n      importerUrl,\n      projectDirectoryUrl,\n    )\n    const scope =\n      importerPackageDirectoryUrl === projectDirectoryUrl\n        ? undefined\n        : `./${urlToRelativeUrl(\n            importerPackageDirectoryUrl,\n            projectDirectoryUrl,\n          )}`\n    const automapping = {\n      scope,\n      from: specifier,\n      to: `./${urlToRelativeUrl(url, projectDirectoryUrl)}`,\n    }\n    if (gotBareSpecifierError) {\n      if (!found) {\n        warn(\n          createImportResolutionFailedWarning({\n            specifier,\n            importedBy,\n            gotBareSpecifierError,\n            suggestsNodeRuntime:\n              runtime !== \"node\" && isSpecifierForNodeCoreModule(specifier),\n          }),\n        )\n        return { found: false }\n      }\n      if (!bareSpecifierAutomapping) {\n        warn(\n          createImportResolutionFailedWarning({\n            specifier,\n            importedBy,\n            gotBareSpecifierError,\n            automapping,\n          }),\n        )\n        return { found: false }\n      }\n      logger.debug(\n        createBareSpecifierAutomappingMessage({\n          specifier,\n          importedBy,\n          automapping,\n        }),\n      )\n      performAutomapping(automapping)\n      return foundFileUrl(url)\n    }\n    if (!found) {\n      warn(\n        createImportResolutionFailedWarning({\n          specifier,\n          importedBy,\n        }),\n      )\n      return { found: false }\n    }\n    if (magicExtension) {\n      if (!extensionlessAutomapping) {\n        const packageDirectoryUrl = packageDirectoryUrlFromUrl(\n          url,\n          projectDirectoryUrl,\n        )\n        const packageFileUrl = resolveUrl(\"package.json\", packageDirectoryUrl)\n        const mappingFoundInPackageExports =\n          await extensionIsMappedInPackageExports(packageFileUrl)\n        if (!mappingFoundInPackageExports) {\n          warn(\n            createImportResolutionFailedWarning({\n              specifier,\n              importedBy,\n              magicExtension,\n              automapping,\n            }),\n          )\n          return { found: false }\n        }\n        logger.debug(\n          createExtensionLessAutomappingMessage({\n            specifier,\n            importedBy,\n            automapping,\n            mappingFoundInPackageExports,\n          }),\n        )\n        performAutomapping(automapping)\n        return foundFileUrl(url)\n      }\n      logger.debug(\n        createExtensionLessAutomappingMessage({\n          specifier,\n          importedBy,\n          automapping,\n        }),\n      )\n      performAutomapping(automapping)\n      return foundFileUrl(url)\n    }\n    return foundFileUrl(url)\n  }\n\n  return { applyImportResolution }\n}\n\nconst fileUrlToHttpUrl = (url, { projectDirectoryUrl, baseUrl }) =>\n  moveUrl({ url, from: projectDirectoryUrl, to: baseUrl })\n\nconst httpUrlToFileUrl = (url, { projectDirectoryUrl, baseUrl }) =>\n  moveUrl({ url, from: baseUrl, to: projectDirectoryUrl })\n\nconst moveUrl = ({ url, from, to }) => {\n  if (urlIsInsideOf(url, from)) {\n    const relativeUrl = urlToRelativeUrl(url, from)\n    return resolveUrl(relativeUrl, to)\n  }\n  if (url === from) {\n    return to\n  }\n  return null\n}\n\nconst extensionIsMappedInPackageExports = async (packageFileUrl) => {\n  const closestPackageObject = await readFile(packageFileUrl, {\n    as: \"json\",\n  })\n  // it's imprecise because we are not ensuring the wildcard correspond\n  // to the required mapping, but good enough for now\n  const containsWildcard = Object.keys(closestPackageObject.exports || {}).some(\n    (key) => key.includes(\"*\"),\n  )\n  return containsWildcard\n}\n\nconst packageDirectoryUrlFromUrl = (url, projectDirectoryUrl) => {\n  const relativeUrl = urlToRelativeUrl(url, projectDirectoryUrl)\n\n  const lastNodeModulesDirectoryStartIndex =\n    relativeUrl.lastIndexOf(\"node_modules/\")\n  if (lastNodeModulesDirectoryStartIndex === -1) {\n    return projectDirectoryUrl\n  }\n\n  const lastNodeModulesDirectoryEndIndex =\n    lastNodeModulesDirectoryStartIndex + `node_modules/`.length\n\n  const beforeNodeModulesLastDirectory = relativeUrl.slice(\n    0,\n    lastNodeModulesDirectoryEndIndex,\n  )\n  const afterLastNodeModulesDirectory = relativeUrl.slice(\n    lastNodeModulesDirectoryEndIndex,\n  )\n  const remainingDirectories = afterLastNodeModulesDirectory.split(\"/\")\n\n  if (afterLastNodeModulesDirectory[0] === \"@\") {\n    // scoped package\n    return `${projectDirectoryUrl}${beforeNodeModulesLastDirectory}${remainingDirectories\n      .slice(0, 2)\n      .join(\"/\")}`\n  }\n  return `${projectDirectoryUrl}${beforeNodeModulesLastDirectory}${remainingDirectories[0]}/`\n}\n\nconst magicExtensionWithImporterExtension = (magicExtensions, importer) => {\n  const importerExtension = urlToExtension(importer)\n  const magicExtensionsWithoutImporterExtension = magicExtensions.filter(\n    (ext) => ext !== importerExtension,\n  )\n  return [importerExtension, ...magicExtensionsWithoutImporterExtension]\n}\n",
    "export const importMapToVsCodeConfigPaths = ({ imports = {} }) => {\n  const paths = {}\n\n  Object.keys(imports).forEach((importKey) => {\n    const importValue = imports[importKey]\n\n    let key\n    if (importKey.endsWith(\"/\")) {\n      key = `${importKey}*`\n    } else {\n      key = importKey\n    }\n\n    const importValueArray =\n      typeof importValue === \"string\" ? [importValue] : importValue\n    const candidatesForPath = importValueArray.map((importValue) => {\n      if (importValue.endsWith(\"/\")) {\n        return `${importValue}*`\n      }\n      return importValue\n    })\n\n    if (key in paths) {\n      paths[key] = [...paths[key], ...candidatesForPath]\n    } else {\n      paths[key] = candidatesForPath\n    }\n  })\n\n  return paths\n}\n",
    "import { createLogger } from \"@jsenv/logger\"\nimport {\n  assertAndNormalizeDirectoryUrl,\n  writeFile,\n  resolveUrl,\n  readFile,\n  urlToFileSystemPath,\n} from \"@jsenv/filesystem\"\nimport { sortImportMap } from \"@jsenv/importmap\"\n\nimport { assertInitialImportMap } from \"./internal/assertInitialImportMap.js\"\nimport { packageConditionsFromPackageUserConditions } from \"./internal/package_conditions.js\"\nimport { visitNodeModuleResolution } from \"./internal/from-package/visitNodeModuleResolution.js\"\nimport { optimizeImportMap } from \"./internal/optimizeImportMap.js\"\nimport { resolveProjectEntryPoint } from \"./internal/from-js/resolveProjectEntryPoint.js\"\nimport { visitSourceFiles } from \"./internal/from-js/visitSourceFiles.js\"\nimport { importMapToVsCodeConfigPaths } from \"./internal/importMapToVsCodeConfigPaths.js\"\n\nexport const writeImportMapFiles = async ({\n  logLevel,\n  projectDirectoryUrl,\n  importMapFiles,\n  packagesManualOverrides,\n  onWarn = (warning, warn) => {\n    warn(warning)\n  },\n  writeFiles = true,\n  exportsFieldWarningConfig,\n  // for unit test\n  jsConfigFileUrl,\n}) => {\n  const logger = createLogger({ logLevel })\n  const warn = wrapWarnToWarnOnce((warning) => {\n    onWarn(warning, () => {\n      logger.warn(`\\n${warning.message}\\n`)\n    })\n  })\n\n  projectDirectoryUrl = assertAndNormalizeDirectoryUrl(projectDirectoryUrl)\n\n  if (typeof importMapFiles !== \"object\" || importMapFiles === null) {\n    throw new TypeError(\n      `importMapFiles must be an object, received ${importMapFiles}`,\n    )\n  }\n  const importMapFileRelativeUrls = Object.keys(importMapFiles)\n  const importMapFileCount = importMapFileRelativeUrls.length\n  if (importMapFileCount.length) {\n    throw new Error(`importMapFiles object is empty`)\n  }\n\n  const importMaps = {}\n  const nodeResolutionVisitors = []\n  importMapFileRelativeUrls.forEach((importMapFileRelativeUrl) => {\n    const importMapConfig = importMapFiles[importMapFileRelativeUrl]\n\n    const { initialImportMap = {} } = importMapConfig\n    assertInitialImportMap(initialImportMap)\n    const topLevelMappings = initialImportMap.imports || {}\n    const scopedMappings = initialImportMap.scopes || {}\n    const importMap = {\n      imports: topLevelMappings,\n      scopes: scopedMappings,\n    }\n    importMaps[importMapFileRelativeUrl] = importMap\n\n    const {\n      mappingsForNodeResolution,\n      mappingsForDevDependencies,\n      packageUserConditions,\n      packageIncludedPredicate,\n      runtime = \"browser\",\n    } = importMapConfig\n    if (mappingsForNodeResolution) {\n      nodeResolutionVisitors.push({\n        mappingsForDevDependencies,\n        packageConditions: packageConditionsFromPackageUserConditions({\n          runtime,\n          packageUserConditions,\n        }),\n        packageIncludedPredicate,\n        onMapping: ({ scope, from, to }) => {\n          if (scope) {\n            scopedMappings[scope] = {\n              ...(scopedMappings[scope] || {}),\n              [from]: to,\n            }\n          } else {\n            topLevelMappings[from] = to\n          }\n        },\n      })\n    }\n  })\n\n  if (nodeResolutionVisitors.length > 0) {\n    await visitNodeModuleResolution({\n      logger,\n      warn,\n      projectDirectoryUrl,\n      visitors: nodeResolutionVisitors,\n      packagesManualOverrides,\n      exportsFieldWarningConfig,\n    })\n  }\n\n  await importMapFileRelativeUrls.reduce(\n    async (previous, importMapFileRelativeUrl) => {\n      const importMapConfig = importMapFiles[importMapFileRelativeUrl]\n      const {\n        checkImportResolution,\n        // ideally we could enable extensionlessAutomapping and bareSpecifierAutomappingonly for a subset\n        // of files. Not that hard to do, especially using @jsenv/url-meta\n        // but that's super extra fine tuning that I don't have time/energy to do for now\n        bareSpecifierAutomapping,\n        extensionlessAutomapping,\n        magicExtensions,\n        removeUnusedMappings,\n        packageUserConditions,\n        runtime = \"browser\",\n      } = importMapConfig\n\n      if (\n        checkImportResolution ||\n        bareSpecifierAutomapping ||\n        extensionlessAutomapping ||\n        removeUnusedMappings\n      ) {\n        if (checkImportResolution === false) {\n          logger.warn(\n            `\"checkImportResolution\" cannot be disabled when automapping or \"removeUnusedMappings\" are enabled`,\n          )\n        }\n        if (extensionlessAutomapping && !magicExtensions) {\n          logger.warn(\n            `\"magicExtensions\" is required when \"extensionlessAutomapping\" is enabled`,\n          )\n        }\n\n        const projectEntryPoint = await resolveProjectEntryPoint({\n          logger,\n          warn,\n          projectDirectoryUrl,\n          packageUserConditions,\n          runtime,\n        })\n\n        if (projectEntryPoint) {\n          const importMap = await visitSourceFiles({\n            logger,\n            warn,\n            projectDirectoryUrl,\n            projectEntryPoint,\n            importMap: importMaps[importMapFileRelativeUrl],\n            bareSpecifierAutomapping,\n            extensionlessAutomapping,\n            magicExtensions,\n            removeUnusedMappings,\n            runtime,\n          })\n          importMaps[importMapFileRelativeUrl] = importMap\n        }\n      }\n    },\n    Promise.resolve(),\n  )\n\n  Object.keys(importMaps).forEach((key) => {\n    const importMap = importMaps[key]\n    const importMapNormalized = sortImportMap(optimizeImportMap(importMap))\n    importMaps[key] = importMapNormalized\n  })\n\n  if (writeFiles) {\n    await importMapFileRelativeUrls.reduce(\n      async (previous, importMapFileRelativeUrl) => {\n        await previous\n        const importmapFileUrl = resolveUrl(\n          importMapFileRelativeUrl,\n          projectDirectoryUrl,\n        )\n        const importMap = importMaps[importMapFileRelativeUrl]\n        await writeFile(importmapFileUrl, JSON.stringify(importMap, null, \"  \"))\n        logger.info(`-> ${urlToFileSystemPath(importmapFileUrl)}`)\n      },\n      Promise.resolve(),\n    )\n  }\n\n  const firstUpdatingJsConfig = importMapFileRelativeUrls.find(\n    (importMapFileRelativeUrl) => {\n      const importMapFileConfig = importMapFiles[importMapFileRelativeUrl]\n      return importMapFileConfig.useForJsConfigJSON\n    },\n  )\n  if (firstUpdatingJsConfig) {\n    jsConfigFileUrl =\n      jsConfigFileUrl || resolveUrl(\"./jsconfig.json\", projectDirectoryUrl)\n    const jsConfigCurrent = (await readCurrentJsConfig(jsConfigFileUrl)) || {\n      compilerOptions: {},\n    }\n    const importMapUsedForVsCode = importMaps[firstUpdatingJsConfig]\n    const jsConfigPaths = importMapToVsCodeConfigPaths(importMapUsedForVsCode)\n    const jsConfig = {\n      ...jsConfigDefault,\n      ...jsConfigCurrent,\n      compilerOptions: {\n        ...jsConfigDefault.compilerOptions,\n        ...jsConfigCurrent.compilerOptions,\n        // importmap is the source of truth -> paths are overwritten\n        // We coudldn't differentiate which one we created and which one where added manually anyway\n        paths: jsConfigPaths,\n      },\n    }\n    await writeFile(jsConfigFileUrl, JSON.stringify(jsConfig, null, \"  \"))\n    logger.info(`-> ${urlToFileSystemPath(jsConfigFileUrl)}`)\n  }\n\n  return importMaps\n}\n\nconst wrapWarnToWarnOnce = (warn) => {\n  const warnings = []\n  return (warning) => {\n    const alreadyWarned = warnings.some((warningCandidate) => {\n      return JSON.stringify(warningCandidate) === JSON.stringify(warning)\n    })\n    if (alreadyWarned) {\n      return\n    }\n\n    if (warnings.length > 1000) {\n      warnings.shift()\n    }\n    warnings.push(warning)\n    warn(warning)\n  }\n}\n\nconst jsConfigDefault = {\n  compilerOptions: {\n    baseUrl: \".\",\n    paths: {},\n  },\n}\n\nconst readCurrentJsConfig = async (jsConfigFileUrl) => {\n  try {\n    const currentJSConfig = await readFile(jsConfigFileUrl, { as: \"json\" })\n    return currentJSConfig\n  } catch (e) {\n    return null\n  }\n}\n"
  ],
  "names": [
    "assertInitialImportMap",
    "value",
    "TypeError",
    "type",
    "imports",
    "scopes",
    "rest",
    "extraKeys",
    "Object",
    "keys",
    "length",
    "packageConditionsFromPackageUserConditions",
    "runtime",
    "packageUserConditions",
    "Array",
    "isArray",
    "forEach",
    "userCondition",
    "createPreferExportsFieldWarning",
    "packageInfo",
    "packageEntryFieldName",
    "packageName",
    "object",
    "name",
    "packageEntrySpecifier",
    "exportsSubpathCondition",
    "suggestedOverride",
    "exports",
    "code",
    "message",
    "createDetailedMessage",
    "urlToFileSystemPath",
    "url",
    "JSON",
    "stringify",
    "getCreatePullRequestSuggestion",
    "createBrowserFieldNotImplementedWarning",
    "browser",
    "repositoryUrl",
    "getRepositoryUrl",
    "repository",
    "undefined",
    "createPackageNameMustBeAStringWarning",
    "createImportResolutionFailedWarning",
    "specifier",
    "importedBy",
    "gotBareSpecifierError",
    "magicExtension",
    "suggestsNodeRuntime",
    "automapping",
    "getImportResolutionFailedSuggestions",
    "createBareSpecifierAutomappingMessage",
    "mappingToImportmapString",
    "createExtensionLessAutomappingMessage",
    "mappingFoundInPackageExports",
    "suggestions",
    "addSuggestion",
    "suggestion",
    "suggestionCount",
    "mappingToUrlRelativeToFile",
    "mapping",
    "scope",
    "to",
    "scopeUrl",
    "resolveUrl",
    "toUrl",
    "urlToRelativeUrl",
    "from",
    "resolveFile",
    "fileUrl",
    "magicDirectoryIndexEnabled",
    "magicExtensionEnabled",
    "magicExtensions",
    "fileStat",
    "readFileSystemNodeStat",
    "nullIfNotFound",
    "isFile",
    "found",
    "isDirectory",
    "indexFileSuffix",
    "endsWith",
    "indexFileUrl",
    "result",
    "magicDirectoryIndex",
    "extension",
    "urlToExtension",
    "extensionLeadingToAFile",
    "findExtensionLeadingToFile",
    "urlDirectoryUrl",
    "urlFilename",
    "urlToFilename",
    "extensionLeadingToFile",
    "firstOperationMatching",
    "array",
    "start",
    "extensionCandidate",
    "urlCandidate",
    "stats",
    "predicate",
    "Boolean",
    "resolvePackageMain",
    "logger",
    "warn",
    "exportsFieldSeverity",
    "packageConditions",
    "packageDirectoryUrl",
    "decidePackageEntryFieldName",
    "tryToResolvePackageEntryFile",
    "nonStandardFieldFound",
    "find",
    "condition",
    "moduleFieldValue",
    "module",
    "jsNextFieldValue",
    "browserFieldValue",
    "browserFieldWarning",
    "debug",
    "exportsFieldWarning",
    "relativeUrlToTry",
    "urlFirstCandidate",
    "startsWith",
    "warning",
    "createPackageEntryMustBeRelativeWarning",
    "createPackageEntryNotFoundWarning",
    "relativeUrl",
    "join",
    "visitPackageImportMap",
    "packageImportmap",
    "importmap",
    "projectDirectoryUrl",
    "importmapFileUrl",
    "readFile",
    "as",
    "moveImportMap",
    "e",
    "createPackageImportMapNotFoundWarning",
    "createPackageImportMapUnexpectedWarning",
    "specifierIsRelative",
    "test",
    "visitPackageImports",
    "packageImports",
    "importsSubpaths",
    "onImportsSubpath",
    "key",
    "trace",
    "createSubpathValueMustBeRelativeWarning",
    "valueTrace",
    "keyNormalized",
    "valueNormalized",
    "visitSubpathValue",
    "subpathValue",
    "subpathValueTrace",
    "handleString",
    "handleObject",
    "handleRemaining",
    "firstBareKey",
    "slice",
    "reverse",
    "followConditionBranch",
    "conditionTrace",
    "bareKeys",
    "conditionalKeys",
    "availableKey",
    "push",
    "createSubpathKeysAreMixedWarning",
    "leadsToSomething",
    "some",
    "keyCandidate",
    "includes",
    "valueCandidate",
    "createSubpathIsUnexpectedWarning",
    "visitPackageExports",
    "packageExports",
    "exportsSubpaths",
    "packageDirectoryRelativeUrl",
    "onExportsSubpath",
    "specifierToSource",
    "addressToDestination",
    "handleFalse",
    "handleNull",
    "firstRelativeKey",
    "relativeKeys",
    "exportsObjectFromExportsArray",
    "exportsArray",
    "exportsObject",
    "exportValue",
    "assign",
    "default",
    "address",
    "map",
    "memoizeAsyncFunctionByUrl",
    "fn",
    "cache",
    "memoizeAsyncFunction",
    "getMemoryEntryFromArguments",
    "get",
    "set",
    "promise",
    "delete",
    "memoizeAsyncFunctionBySpecifierAndImporter",
    "importerCache",
    "importer",
    "specifierCacheForImporter",
    "memoized",
    "args",
    "memoryEntry",
    "promiseFromMemory",
    "resolve",
    "reject",
    "createControllablePromise",
    "error",
    "isInMemory",
    "Promise",
    "res",
    "rej",
    "PACKAGE_NOT_FOUND",
    "PACKAGE_WITH_SYNTAX_ERROR",
    "readPackageFile",
    "packageFileUrl",
    "packageObject",
    "console",
    "formatPackageSyntaxErrorLog",
    "syntaxError",
    "applyPackageManualOverride",
    "packagesManualOverrides",
    "version",
    "overrideKey",
    "overrideKeyCandidate",
    "composeObject",
    "leftObject",
    "rightObject",
    "composedObject",
    "rightValue",
    "leftValue",
    "createFindNodeModulePackage",
    "readPackageFileMemoized",
    "dependencyName",
    "nodeModuleCandidates",
    "getNodeModuleCandidates",
    "nodeModuleCandidate",
    "packageFileUrlCandidate",
    "packageObjectCandidate",
    "packageJsonObject",
    "fileDirectoryUrl",
    "fileDirectoryRelativeUrl",
    "candidates",
    "relativeNodeModuleDirectoryArray",
    "split",
    "shift",
    "i",
    "visitNodeModuleResolution",
    "visitors",
    "exportsFieldWarningConfig",
    "projectPackageFileUrl",
    "findNodeModulePackage",
    "seen",
    "markPackageAsSeen",
    "importerPackageFileUrl",
    "packageIsSeen",
    "visit",
    "packageVisitors",
    "packageImporterInfo",
    "isDevDependency",
    "filter",
    "visitor",
    "packageIncludedPredicate",
    "visitDependencies",
    "visitPackage",
    "dependencyMap",
    "packageDependenciesFromPackageObject",
    "all",
    "dependencyInfo",
    "visitorsForDevDependencies",
    "mappingsForDevDependencies",
    "visitDependency",
    "dependencyData",
    "findDependency",
    "cannotFindPackageWarning",
    "createCannotFindPackageWarning",
    "isOptional",
    "dependencyPackageFileUrl",
    "dependencyPackageJsonObject",
    "packageDerivedInfo",
    "computePackageDerivedInfo",
    "addImportMapForPackage",
    "importMap",
    "packageIsRoot",
    "triggerVisitorOnMapping",
    "scopeMappings",
    "toMoved",
    "moveMappingValue",
    "scopeMoved",
    "addMappingsForPackageAndImporter",
    "mappings",
    "importerIsRoot",
    "importerRelativeUrl",
    "importsFromPackageField",
    "mappingsFromPackageImports",
    "mappingsFromPackageExports",
    "indexOf",
    "fromWithouTrailingStar",
    "toWithoutTrailingStar",
    "createExportsWildcardIgnoredWarning",
    "visitPackageMain",
    "packageDirectoryUrlExpected",
    "reduce",
    "previous",
    "shouldWarnAboutExportsField",
    "mainResolutionInfo",
    "main",
    "mainFileRelativeUrl",
    "dependenciesCache",
    "dependencyPromise",
    "projectPackageObject",
    "Error",
    "lastIndexOf",
    "onMapping",
    "packageDependencies",
    "dependencies",
    "optionalDependencies",
    "versionPattern",
    "peerDependencies",
    "peerDependenciesMeta",
    "optional",
    "devDependencies",
    "hasOwnProperty",
    "importerPackageDirectoryUrl",
    "dependencyIsOptional",
    "dependencyType",
    "dependencyVersionPattern",
    "optimizeImportMap",
    "scopesOptimized",
    "scopeMappingsOptimized",
    "mappingKey",
    "topLevelMappingValue",
    "mappingValue",
    "entryPointResolutionFailureMessage",
    "resolveProjectEntryPoint",
    "projectPackageName",
    "projectPackageInfo",
    "reason",
    "tryExportSubpath",
    "exportSubpath",
    "packageSubpaths",
    "subpathKey",
    "packageMainResolutionInfo",
    "subpathUrl",
    "filesystemStat",
    "filenameContainsBackSlashes",
    "__filename",
    "replace",
    "require",
    "createRequire",
    "traverse",
    "parseImportSpecifiers",
    "urlResponseText",
    "babelOptions",
    "ast",
    "parseAsync",
    "sourceType",
    "filename",
    "plugins",
    "parserOpts",
    "ranges",
    "specifiers",
    "addSpecifier",
    "path",
    "node",
    "line",
    "loc",
    "column",
    "CallExpression",
    "callee",
    "arguments",
    "ExportAllDeclaration",
    "ExportNamedDeclaration",
    "source",
    "ImportDeclaration",
    "showSource",
    "showSourceLocation",
    "red",
    "grey",
    "ansiResetSequence",
    "numberOfSurroundingLinesToShow",
    "lineMaxLength",
    "color",
    "markColor",
    "asideColor",
    "colorMark",
    "string",
    "colorAside",
    "mark",
    "aside",
    "lines",
    "lineRange",
    "end",
    "moveLineRangeUp",
    "moveLineRangeDown",
    "lineRangeWithinLines",
    "linesToShow",
    "endLineNumber",
    "lineNumberMaxWidth",
    "String",
    "columnRange",
    "Math",
    "floor",
    "ceil",
    "lineSource",
    "index",
    "lineNumber",
    "isMainLine",
    "lineSourceTruncated",
    "applyColumnRange",
    "lineNumberWidth",
    "lineNumberRightSpacing",
    "repeat",
    "asideSource",
    "lineFormatted",
    "lineSourceUntilColumn",
    "spacing",
    "stringToSpaces",
    "mainLineFormatted",
    "prefix",
    "suffix",
    "lastIndex",
    "startTruncated",
    "endTruncated",
    "number",
    "visitSourceFiles",
    "projectEntryPoint",
    "bareSpecifierAutomapping",
    "extensionlessAutomapping",
    "removeUnusedMappings",
    "addMapping",
    "topLevelMappingsUsed",
    "scopedMappingsUsed",
    "markMappingAsUsed",
    "baseUrl",
    "fileUrlToHttpUrl",
    "loadOptionsAsync",
    "root",
    "importResolver",
    "createImportResolver",
    "onImportMapping",
    "performAutomapping",
    "visitUrl",
    "ignore",
    "body",
    "applyImportResolution",
    "visitUrlResponse",
    "httpUrlToFileUrl",
    "specifierInfo",
    "importsUsed",
    "scopesUsed",
    "mappingsUsed",
    "scopedMappings",
    "composeTwoImportMaps",
    "importMapNormalized",
    "normalizeImportMap",
    "BARE_SPECIFIER_ERROR",
    "isSpecifierForNodeCoreModule",
    "importUrl",
    "resolveImportUrl",
    "importFileUrl",
    "handleFileUrl",
    "handleHttpUrl",
    "resolveImport",
    "defaultExtension",
    "createBareSpecifierError",
    "foundFileUrl",
    "isJs",
    "httpUrl",
    "magicExtensionWithImporterExtension",
    "importerUrl",
    "packageDirectoryUrlFromUrl",
    "extensionIsMappedInPackageExports",
    "moveUrl",
    "urlIsInsideOf",
    "closestPackageObject",
    "containsWildcard",
    "lastNodeModulesDirectoryStartIndex",
    "lastNodeModulesDirectoryEndIndex",
    "beforeNodeModulesLastDirectory",
    "afterLastNodeModulesDirectory",
    "remainingDirectories",
    "importerExtension",
    "magicExtensionsWithoutImporterExtension",
    "ext",
    "importMapToVsCodeConfigPaths",
    "paths",
    "importKey",
    "importValue",
    "importValueArray",
    "candidatesForPath",
    "writeImportMapFiles",
    "logLevel",
    "importMapFiles",
    "onWarn",
    "writeFiles",
    "jsConfigFileUrl",
    "createLogger",
    "wrapWarnToWarnOnce",
    "assertAndNormalizeDirectoryUrl",
    "importMapFileRelativeUrls",
    "importMapFileCount",
    "importMaps",
    "nodeResolutionVisitors",
    "importMapFileRelativeUrl",
    "importMapConfig",
    "initialImportMap",
    "topLevelMappings",
    "mappingsForNodeResolution",
    "checkImportResolution",
    "sortImportMap",
    "writeFile",
    "info",
    "firstUpdatingJsConfig",
    "importMapFileConfig",
    "useForJsConfigJSON",
    "jsConfigCurrent",
    "readCurrentJsConfig",
    "compilerOptions",
    "importMapUsedForVsCode",
    "jsConfigPaths",
    "jsConfig",
    "jsConfigDefault",
    "warnings",
    "alreadyWarned",
    "warningCandidate",
    "currentJSConfig"
  ],
  "mappings": "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"
}